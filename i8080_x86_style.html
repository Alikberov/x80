<html>
<head>
<title>Binary Pattern</title>
<script>
/*
i8275 CRT-Controller: Simply version
00000000: 
000000nn: 
000001nn: 
00001nnn: 
0001nnnn: 
0010nnnn: 
0100nnnn: Lines [1..16]-1
01nnnnnn: Rows [16..64]-1
1000nnnn: 
1nnnnnnn: Cols [16..80]-1
1101nnnn: 
1110nnnn: 
1111nnnn: 

40..4F: Set Lines [1..16]
50..7F: Set Rows [16..64]
90..CF: Set Cols [16..80]



*/
Number.prototype.toHex = function(n) {
	return	(n < 0 ? "0x" : "") + ((((this >> 16) & 0x0000FFFF) | 0x00010000).toString(16) + ((this & 0x0000FFFF) | 0x00010000).toString(16).substr(1)).substr(-Math.abs(n)).toUpperCase();
}

Object.defineProperty(Array.prototype, 'toDump', {
	enumerable	: false,
	value		: function(fmt, ptr) {
			var	width	= fmt.split(".").length - 1,
				minuses	= (fmt.split("-").length - 1) >> 1,
				pluses	= (fmt.split("+").length - 1) >> 1,
				codes	= "",
				letters	= [],
				address	= ptr.toHex(fmt.split("@").length - 1).split(""),
				data;
			ptr -= minuses;
			while(width --)
				data = Number(this[((ptr + width + this.length) % this.length)]),
				codes = data.toHex(2) + codes,
				letters.unshift(data < 32 || data > 126 ? "&#183;" : "&#" + data + ";");
			codes = codes.split("");
			return	fmt.replace(/[-@.+]/g,
				function(letter) {
					switch(letter) {
					case	".":	return	letters.shift();
					case	"@":	return	address.shift();
					default:	return	codes.shift();
					}
				}
			);
		}
	}
);
Object.defineProperty(Array.prototype, 'toHex', {
	enumerable	: false,
	value		: function(ofs, sep) {
				var	s = "", t = [], n, tmp;
				if(sep && sep.length > 1) {
					n = sep.split(/\s+|\|/).length;
					ofs -= sep.split(/\|/)[0].split(/\s/).length;
					while(n --)
						tmp = this[(ofs + n + this.length) % this.length],
						s = tmp.toHex(2) + s,
						t.unshift("&#" + (tmp >= 32 && tmp < 127 ? tmp : 0xB7) + ";");
					return	sep.replace(/-|\./g, function(c) {
							var	tmp;
							if(c == "-")
								tmp = s.charAt(0),
								s = s.substr(1);
							else
								tmp = t.shift();
							return	tmp;
						}).replace(/\s/g, "\xA0");
				}
				tmp = [];
				this.forEach(function(code) {
					tmp.push(Number(code).toHex(2));
				});
				s = tmp.join("\xA0");
				return	!ofs || !sep ? s : s.replace(new RegExp("(([0-9A-F]{2}\\s?){" + ofs + "})\\s", "g"), "$1" + sep);
			}
});
Object.defineProperty(Array.prototype, 'toText', {
	enumerable	: false,
	value		: function() {
				var	s = "";
				this.forEach(function(code) {
					s += "&#" + /*String.fromCharCode*/(c >= 32 && c < 127 ? c : 0xB7) + ";";
				});
				return s;
			}
});

String.prototype.x = function(n, j) {var s = this, buf = ""; while(n > 0) { if(n&1) buf+=s; s+=(j?j:"")+s; n >>= 1; } return buf; }

Number.prototype.hi = function(n) {
	if(isFinite(n))
		return	(this & 255) | ((n & 255) << 8);
	return	(this >> 8) & 255;
}
Number.prototype.lo = function(n) {
	if(isFinite(n))
		return	(this & 0xFF00) | (n & 255);
	return	this & 255;
}
var	CPU	=
function(pattern) {
	"use strict"
	var	Register	=
	function(x) {
		return	{
			id	: "",
			fx	: 0,
			hi	: (x >> 8) & 255,
			lo	: x & 255,
			start	: x & 65535,
			get reset()	{
				this.lo = this.start & 255,
				this.hi = this.start >> 8;
				return	this.lo | (this.hi << 8);
			},
			get h()		{
				return	this.hi;
			},
			set h(x)	{
				this.fx = (x >> 8) & 1;
				this.hi = (x &= 255);
				this.fx |= (x & 128) | (!x ? 64 : 0);
				x ^= x >> 4;
				x ^= x << 2;
				x ^= x >> 1;
				this.fx |= x & 4;
				//console.log(this.id + ":" + (this.lo | (this.hi << 8)).toHex(-4));
			},
			get l()		{
				return	this.lo;
			},
			set l(x)	{
				this.fx = (x >> 8) & 1;
				this.lo = (x &= 255);
				this.fx |= (x & 128) | (!x ? 64 : 0);
				x ^= x >> 4;
				x ^= x << 2;
				x ^= x >> 1;
				this.fx |= x & 4;
				//console.log(this.id + ":" + (this.lo | (this.hi << 8)).toHex(-4));
			},
			get x()		{
				//console.log(this.id + ":" + (this.lo | (this.hi << 8)).toHex(-4));
				return	this.lo | (this.hi << 8);
			},
			set x(x)	{
				this.lo = x & 255, this.hi = (x >> 8) & 255;
				//console.log(this.id + ":" + (this.lo | (this.hi << 8)).toHex(-4));
			},
			get m()		{
				//console.log(this.id + "[" + (this.lo | (this.hi << 8)).toHex(-4) + "]:" + (ram[this.lo | (this.hi << 8)] & 255).toHex(-2));
				return	ram[this.lo | (this.hi << 8)] & 255;
			},
			set m(x)	{
				ram[this.lo | (this.hi << 8)] = x & 255;
				//console.log(this.id + "[" + (this.lo | (this.hi << 8)).toHex(-4) + "]=" + (ram[this.lo | (this.hi << 8)] & 255).toHex(-2));
			},
			get n()		{
				var	x = this.lo | (this.hi << 8);
				this.lo = (this.lo + 1) & 255;
				this.hi = !this.lo ? (this.hi + 1) & 255 : this.hi;
				return	ram[x];
			},
			set n(x)	{
				this.hi = !this.lo ? (this.hi - 1) & 255 : this.hi;
				this.lo = (this.lo - 1) & 255;
				ram[this.lo | (this.hi << 8)] = x & 255;
			},
			get w()		{
				var	x = this.lo | (this.hi << 8), d;
				this.lo = (this.lo + 2) & 255;
				this.hi = this.lo < 2 ? (this.hi + 1) & 255 : this.hi;
				d = ram[x] + 256 * ram[(x + 1) & 65535];
				//console.log("[" + x.toHex(-4) + "]:" + d.toHex(-4));
				return	d;
			},
			set w(x)	{
				this.hi = this.lo < 2 ? (this.hi - 1) & 255 : this.hi;
				this.lo = (this.lo - 2) & 255;
				ram[this.lo | (this.hi << 8)] = x & 255;
				ram[(this.lo + (this.hi << 8) + 1) & 65535] = (x >> 8) & 255;
				//console.log("[" + (this.lo | (this.hi << 8)).toHex(-4) + "]=" + x.toHex(-4));
			},
		}
	};
	var	CPU_ID		= "XPU v1.0";
	var	m		= null;		// Memory
	var	r		= null;		// Registers
	var	core = {
		actions		: [],		// Instructions set
		commands	: [],		// Assembly commands
		is_active	: false,	// Execution activity
		scale		: 1,		// Instructions per cycle
		clock		: 512,		// Cycles per second
		ready		: false,	// Model status
	};
	var	user = {
		actions		: null,		// Browsing instructions set table
		disassemblies	: null,		// Browsing disassembling list
		styles		: {		// Instruction presentable styles
			style	: 0,		// Unactive instruction presentable style
			active	: 1,		// Active instruction
			breaker	: 2,		// Breaked instruction
			crack	: 3,		// Breaked active instruction
			debug	: 4,		// Debug view selected instruction
			enable	: 5,		// Debug view active instruction
			fixed	: 6,		// Debug view breaked instruction
			gap	: 7,		// Debug view breaked active instruction
			zip	: [],		// Enumerated styles table for disassembler
		},
	};
	var	debug = {
		active		: true,		// Active debug / Running
		step		: false,	// Single step debugging
		halt		: [],		// Break-points
		text		: [],		// Text-points
		labels		: [],		// Labels
		address		: 0,
		pointer		: 0,		// Disassembly start address
		lines		: 32,		// Disassembly rows number
		string		: "",		// Disassembling format
		data		: [],		// Disassembling data representation
		flash		: 10,		// Screen redraws per second
		choice		: 0xF803,	// User line
		stamps		: [0,0],
		hTimer		: null,
	};
	var	watch = {
		iAdjust		: 0,
		nAdujst		: 1,
		sAdjust		: "",
		dirty		: true,
	};
	var	Logging		= [];
	var	$0, $1, $2;
	// Отображение таблицы команд
	this.showCommands = function(e) {
		user.actions = e;
	};
	// Отображение таблицы команд
	this.showListing = function(e) {
		user.disassemblies = e;
		user.disassemblies.onmousemove = function(e) {
			//document.title = t.r;
		}
		user.disassemblies.onkeyup = function(e) {
function getCharacterOffsetWithin(range, node) {
    var treeWalker = document.createTreeWalker(
        node,
        NodeFilter.SHOW_TEXT,
        function(node) {
            var nodeRange = document.createRange();
            nodeRange.selectNodeContents(node);
            return nodeRange.compareBoundaryPoints(Range.END_TO_END, range) < 1 ?
                NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT;
        },
        false
    );

    var charCount = 0;
    while (treeWalker.nextNode()) {
        charCount += treeWalker.currentNode.length;
    }
    if (range.startContainer.nodeType == 3) {
        charCount += range.startOffset;
    }
    return charCount;
}

    var el = document.getElementById("test");
    var range = window.getSelection().getRangeAt(0);
			document.title = getCharacterOffsetWithin(range, this);
		}
	};
	function reset() {
		for(var id in r)
			r[id].reset;
		console.log(CPU_ID + ": Reset...");
	}
	function step() {
		clearTimeout(debug.hTimer);
		debug.hTimer = setTimeout(step.bind(this), 1000 / core.clock);
		if(!core.ready)
			return;
		var	code	= 0|0;
		var	scale	= 0|0;
		var	$IP	= r.pc.x;
		this.r = r;
		scale = !!core.is_active || debug.is_step ? debug.is_step ? 1 : core.scale : 0;
		if((debug.is_step && !!core.is_active && !debug.halt[r.pc.x]))
			core.is_active = false,
			disassm();
		if((!debug.is_step && !!core.is_active && debug.halt[r.pc.x]))
		;//	disassm();
		while(!!debug.is_step || ((!debug.halt[r.pc.x] && !!core.is_active) && (scale -- > 0))) {
			code = eval(core.actions[CPU_ID].action);
			if(debug.is_step)
				debug.is_step = false;
			this.step.actions[code].bind(this).call(this);
//			eval(core.actions[code].action);
		}
		if(debug.pointer != r.pc.x)
			debug.pointer = r.pc.x,
			disassm();
	}
	function command_set(ic, ib) {
		var	large = false,
			color = "<span class='",
			style,
			datax = [],
			cols = 7,
			spaces = "\xA0".x(cols),
			dump = [],
			head = [],
			foot = [],
			code,
			data = "_".x(4),
			action,
			command,
			operand,
			tmp;
		for(var id in debug.data)
			datax.push(id);
		if(!isFinite(ib))
			ib = 0;
		datax = new RegExp(datax.join("|"));
		for(code = 0; code < 256; ++ code) {
			action = core.actions[code];
			command = action.command + spaces;
			operand = action.operand.replace(datax,
				function(s) {
					return	(isFinite(ic) && (code == +ic) ? (data = ib.toHex(s.length)) : debug.data[s]);
				}
			);
			tmp = operand.length - cols;
			if(tmp > 0)
				command = command.substr(0, cols - tmp) + operand,
				operand = operand.substr(-cols);
			tmp = (command + spaces).substr(0, cols) + (operand + spaces).substr(0, cols);
			style = color + user.styles.zip[isFinite(ic) && (code == +ic) ? 1 : 0].replace(/\?/g, action.color) + "'>";
			head.push(style + tmp.substr(0, cols) + "</span>");
			foot.push(style + tmp.substr(cols) + "</span>");
			if((code & 15) == 15)
				dump.push("&#x2551;" + ("<span" + (code > 15 ? " style=text-decoration:overline>" : ">") + (code >> 4).toHex(1) + "&#x2551;" + head.join("&#x2502;") + "</span>&#x2551;<br />")
					+ ("&#x2551; &#x2551;"+ foot.join("&#x2502;") + "&#x2551;").replace(/(IB|XX)/g, "<b style=color:cyan>$1</b>")),
				head = [], foot = [];
		}
		for(code = 0; code < 16; ++ code)
			head.push("&#x2554;&#x2550;&#x2557;"),
			foot.push("&#x2550;".x(cols - 3) + "&#x255D;" + code.toHex(1) + "&#x255A;");
 /*var sel = window.getSelection().getRangeAt(0);   //get cursor position
  sel = [[sel.startContainer,sel.startOffset],  
         [sel.endContainer,sel.endOffset]
  ];   //save cursor position (start and end);
  /*Do whatever, let the user change selected element*/
		user.actions.innerHTML = (isFinite(ic) ? ic.toHex(2) + " " + (data + "\xA0\xA0").substr(0, 4) : "_".x(4).substr(0, 5)) + head.join("\xA0".x(cols - 2)) + "<br />" +
			"&#x2554;&#x2550;&#x2566;" + foot.join("&#x2564;") + "&#x2557;<br />" +
			dump.join(large ? "<br />&#x255F;&#x2500&#x256B;" + "&#x2500;".x(cols).x(16, "&#x253C;") + "&#x2562;<br />" : "<br />") +
			"<br />&#x255A;&#x2550;&#x2569" + "&#x2550".x(cols).x(16, "&#x2567") + "&#x255D";

  /*var range = document.createRange();  //Creade range object. This is not IE compatible!
  range.setStart(sel[0][0], sel[0][1]);  //Load start from our variable
  range.setEnd(sel[1][0], sel[1][1]);    //Load end too
  var s = window.getSelection();
  s.removeAllRanges();  //I'm not sure this is necessary
  s.addRange(range);//*/
	}
	function disassm() {
		var	i, j,
			addr = (debug.pointer &= 0xFFFF),	// active IP
			ip = debug.address & 0xFFFF, lines = debug.lines, next = ip,
			jp,
			list = [], width,
			regs = [],
			ips = [],
			lid,	// label id
			ic, ib = 0, ie, asm,
			ich, icx,
			active = addr.toHex(4) + " " + m[addr].toHex(2),
			extend = "",
			color,
			expression = "",
			rem = "", row,
			cmm = "",
			acc = "???", wait = false;
		if(ip > addr)
			ip = debug.address = (addr + 0xFFF0) & 0xFFFF;
		for(var alias in r) {
			regs.push(eval(r[alias].show));
		}
		lines -= regs.length;
		for(i = 0, jp = ip; i < lines - 2 || jp < addr; ++ i) {
			ips.push(jp);
			ic = m[jp];
			width = (core.actions[ic] ? core.actions[ic].width : 1);
			jp = (jp + width) & 0xFFFF;
		}
		if(ips.length > lines - 2)
			ip = debug.address = ips.pop();
		var	_ptr = 0, _bin =0, _cmd = 0, _opr = 0, _rem = 0;
		var	info = {
			"@"	: null,
			"#"	: null,
			"$"	: null,
			"%"	: null,
			"."	: null,
		};
		var	code, data, act, width;
		debug.string.replace(/@/g, function() { ++ _ptr; });
		debug.string.replace(/#/g, function() { ++ _bin; });
		debug.string.replace(/\$/g,function() { ++ _cmd; });
		debug.string.replace(/%/g, function() { ++ _opr; });
		debug.string.replace(/\./g,function() { ++ _rem; });
		while(lines -- > 0) {
		///////////////////////////////////////////////////////
			info["@"] = ip.toHex(_ptr);
			code = m[ip];
			data = 0;
			info["#"] = "";
			act = core.actions[code];
			width = act.width;
			color = 0;
			while(width --) {
				color |= (ip + width) == addr ? 1 : 0;
				color |= !!debug.halt[ip + width] ? 2 : 0;
				color |= debug.choice == (ip + width) ? 4 : 0;
				info["#"] = m[ip + width].toHex(2) + info["#"];
				if(width)
					data = (data << 8) + m[ip + width];
			}
			info["#"] += ".".x(16);
			info["$"] = act.command + " ".x(_cmd);
			info["%"] = act.operand.replace(/_+(\d)/g, function(s, n) { return data.toHex(-n * 2); }) + " ".x(_opr);
			if(debug.labels[ip])
				info["."] = debug.labels[ip] + " ".x(_rem);
			else
			if(debug.labels[data])
				info["."] = debug.labels[data] + " ".x(_rem);
			else
				info["."] = act.remark + " ".x(_rem);
			asm = debug.string.replace(/([@#$%.])/g, function(id) {
				var	s = info[id].charAt(0);
				info[id] = info[id].substr(1);
				return	s;
			});
			if(color & 1)
				command_set(code, data);
			ip += act.width;
			asm = "<span class='" + user.styles.zip[color].replace(/\?/g, act.color) + "'>" + asm + "</span>";
			if(lines)
				list.push(asm);
		}
		//command_set(ich, icx);
		user.disassemblies.innerHTML = list.concat(regs).join("<br />");
		watch.dirty = 1;
		return;
		var	inter = active.split("|");
		if(watch.active != "P")
			watch.address.value = inter.shift().replace(/\s+$/, "");
		else
			inter.shift();
		if(watch.active != "T")
			watch.mnemonic.value = inter.shift().replace(/\s+/g, "\t").replace(/\s+(\(.*)?$/, "");
		else
			inter.shift();
		if(watch.active != "R")
			watch.remark.value = inter.shift().replace(/\s+$/, "");
		if(expression != "")
			document.getElementById("Eval").innerText = expression;
		watch.dirty = true;
	}
	function assembly(listing, files) {
		var	text = listing.split(/\r?\n/),
			line, part, regs, args, code, regz, regy, regw,
			val_nnIB, val_sxIB, val_s_IB,
			arg_nnIB,
			instr, ins,
			tmp,
			dbg = true,	// Debug mode
			hlt = false,	// Halting flag
			usr = true,	// User mode
			arg, val,
			rego, cnt,
			regas, regaz, regay, regaw, regao,
			ip, ipx,
			labels = {},	// All labels
			label,		// Current label
			labelz = {},
			laps = 8,
			lap = laps,
			prc = 0,
			ign = false,
			prcs = text.length * laps,
			title = document.title,
			bytes,
			file = {
				name	:"",
				begin	:65535,
				end	:0,
				bin	:[]
			},
			bin	= !files ? m : file.bin;
		do {
			ip = -1; label = [], usr = true; ign = false;
			for(line in text) {
				++ prc;
				if(files && !lap && ip >= 0 && file.begin > ip)
					file.begin = ip;
				if(ign)
					continue;
				part = text[line];
				part = /([^:;"'`\s]*(?::| ?))?(?:\s)*([^\s;]*)(?:\s*)([^\s,;"'`]*)(?:[,\s]*)?([^\s,;"'`]*)(?:[,\s]*)?(?:(?:("(?:\\.|.)*?")|('(?:\\.|.)*?')|(`(?:\\.|.)*?`)|[^;"'`]*)*)*(\.*)/.exec(part);
				if(part[1]) {
					part[1] = part[1].replace(/[ :]$/, "");
					tmp = part[1].replace(/:/g, "..").match(/(\.*)(.*)/);
					label = label.slice(0, tmp[1].length).concat(tmp[2].split("."));
					part[1] = label.join(".");
					if(debug.labels[part[1]] != ip)
						delete debug.labels[debug.labels[part[1].toUpperCase()]];
					debug.labels[ip] = part[1],
					debug.labels[part[1].toUpperCase()] = ip;
					/*labelz = {};
					cnt = 1 << 8;
					do {
						var	idn = "";
						for(var id in trace.labels)
							if((id.length > idn.length) && (id.substr(-1) != " ") && !labelz[id])
								idn = id;
							else
								continue;
							//idn = (id.length > idn.length) && (id.substr(-1) != " ") && !labelz[id] ? id : idn;
						if(idn != "")
							labelz[idn] = trace.labels[idn];
					} while((cnt --) && (idn != ""));*/
				}
				part[3] = part[3].replace(/([0-9][0-9A-F]*)h$/gi, "0x$1");
				part[4] = part[4].replace(/([0-9][0-9A-F]*)h$/gi, "0x$1");
				instr = part[2].toUpperCase();
				if(instr.substr(-1) == "?" || instr.substr(-1) == "!") {
					if((dbg || (instr.substr(-1) == "!")) && !lap)
						debug.halt[ip] = true;
					instr = instr.substr(0, instr.length - 1);
				}
				regs = [part[2], part[3]].join(" ").toUpperCase();
				if(part[4])
					regs += "," + part[4].toUpperCase();
				/*if((regs = preset.alias[regs]) || (regs = preset.alias[instr])) {
					regs = regs.split(" ");
					for(var i in regs) {
						if(typeof(regs[i]) == "string")
							ram[ip ++] = parseInt(regs[i], 16);
					}
					continue;
				}*/
				part[3] = part[3].replace(/^(\.+)/, function(str, data) {
					var	data = data.length;
					return label.slice(0, data).join(".") + ".";
				});
				part[4] = part[4].replace(/^(\.+)/, function(str, data) {
					var	data = data.length;
					return label.slice(0, data).join(".") + ".";
				});
				regs = part[3].toUpperCase();
				if(part[4])
					regs += "," + part[4].toUpperCase();
				args = [];
				try{
					regs = regs.replace(/(\.*)([A-Z_a-z][A-Z_a-z.0-9]*)/g, function(str, nest, tag) {
						var	tmp = debug.labels[label.slice(0, nest.length).concat(tag.split(".")).join(".").toUpperCase()];
						//console.log(ip.Hex(4) + " " +str + "::" + nest + ":" + tag + "=" + tmp);
						if(isFinite(tmp))
							return Number(tmp).toHex(-4);
						return	nest + tag;
					});
				/*for(var i in labelz) {
					regs = regs.replace(new RegExp("("+i.replace(/(\.)/g, "\\.")+")", "gi"), function(str, data) {
						return "0x" + Number(labelz[i]).Hex(4);
					});
				}*/
				}catch(e){}
				rego = regs; ipx = false;
				regs = regs.replace(/\$([+-](0x[0-9A-F]+|[0-9]+))/g, function(str, data) {
					ipx = true;
					data = (ip + parseInt(data) - 1) & 0xFFFF;
					args.push(data);
					return "0x" + data.toHex(4);
				});
				regs = regs.replace(/(0x[0-9A-F]+|[0-9]+)(\*|\/)(0x[0-9A-F]+|[0-9]+)+/g, function(str, x, op, y) {
					return	(op == "*" ? parseInt(x) * parseInt(y) : op == "/" && !!parseInt(y) ? parseInt(x) / parseInt(y) : 0x8000).toHex(-4);
				});
				regs = regs.replace(/(0x[0-9A-F]+|[0-9]+)([+-])(0x[0-9A-F]+|[0-9]+)+/g, function(str, x, op, y) {
					return	(op == "+" ? parseInt(x) + parseInt(y) : parseInt(x) - parseInt(y)).toHex(-4);
				});
				regs = regs.replace(/([-+](0x[0-9A-F]+|[0-9]+))/g, function(str, data) {
					return "+" + (parseInt(data) + 256).toHex(-2);
				});
				ins = core.commands[instr];
				code = -1;
				bytes = 0;
				if(ins && (regs in ins))
					code = ins[regs];
				else {
					arg_nnIB = regs.replace(/(0x[0-9A-F]+)|([0-9]+)/gi, function(data) {	// nnIB
						var	bin0 = parseInt(data);
						var	tag00= regs.replace(/(0x[0-9A-F]+)|([0-9]+)/gi, "_2");
						var	tag01= regs.replace(/(0x[0-9A-F]+)|([0-9]+)/gi, "_1");
						var	tag0 = regs.replace(/\+(0x[0-9A-F]+|[0-9]+)/, "+IB");
						var	bin1 = parseInt(data);
						var	tag1 = bin1.hi().toHex(2) + "IB";
						var	bin2 = parseInt(data) + (ipx ? -ip- 3 : -ip - 2);
						var	tag2 = "$+IB";
						var	bin3 = parseInt(data) + (ipx ? -ip- 4 : -ip - 3);
						var	bin3a = bin3 + (bin3 < -128 ? +(bin3 & 0x80) * 2 : bin3 >= 128 ? +(bin3 & 0x80) * 2 : 0);
						var	tag3 = "$+" + ((bin3a >> 8) & 7) + "IB";
						if(ins) {
							if((tag0 in ins) || (tag00 in ins) || (tag01 in ins))
								return	tag01 in ins ? (args.unshift(bin0), bytes = 1, "_1") : (args.unshift(bin0.lo(), bin0.hi()), bytes = 2, "_2");
							if(tag1 in ins)
								return	args.push(bin1) ? tag1 : tag1;
							if(bin2 >= -128 && bin2 < 128 && (tag2 in ins))
								return	args.push(bin2.lo()) ? tag2 : tag2;
							if(((bin3 >= -1024 && bin3 < -128) || (bin3 >= 128 && bin3 <= 895)) && (tag3 in ins))
								return	args.push(bin3.lo()) ? tag3 : tag3;
							if("IB" in ins)
								return	args.push(bin1) ? "IB" : "IB";
							if(part[4] && (regs.split(",")[0] + ",IB") in ins)
								return	(code = ins[part[3] + ",IB"]) && args.push(bin1) ? "" : "";
							if("" in ins)
								return	"";
						}
						args.push(bin1);
						return "";
					});
					if(ins && (arg_nnIB in ins))
						code = ins[arg_nnIB];
					else
					if(part[4] && ins && ([part[4].toUpperCase(), part[3].toUpperCase()].join(",") in ins))
						code = ins[[part[4].toUpperCase(), part[3].toUpperCase()].join(",")];
					else
					if(part[4] && ins && (part[3].toUpperCase() in ins) && (part[4].toUpperCase() in ins))
						code = ins[part[3].toUpperCase()] | (ins[part[4].toUpperCase()] << 16);
					else
					if(ins && (part[3].toUpperCase() in ins))
						code = ins[part[3].toUpperCase()];
					else
					if(part[4] && ins && (regs.toUpperCase() in ins))
						code = ins[regs.toUpperCase()];
					else
					if(ins && ((arg_nnIB = arg_nnIB.replace(/(\[[A-Z]{2})(\])/ig, "$1+IB$2")) in ins))
						code = ins[arg_nnIB], args.unshift(0);
				}
				switch(instr) {
				case	".END":	ign = true;							continue;
				case	"USER":	usr = !!parseInt(regs);						continue;
				case	"FILE":	file.name = regs;						continue;
				case	"DEBUG":dbg = !!parseInt(regs);						continue;
				case	".ORG":	ip = args.shift();						continue;
				case	".EQU":	debug.labels[part[1].toUpperCase()] = args.shift();			continue;
				case	"BRK":	if(files && dbg && !lap) debug.halt[ip] = !!parseInt(regs);	continue;
				case	".DB":
				case	".TEXT":
					if(part[5]) {
						args = part[5].replace(/Ё/ig, "Е").replace(/[абвгдеёжзийклмнопрстуфхцчшщъыьэюя]/ig, function(str, ascii) {
							var	koi7ru = "ЮАБЦДЕФГХИЙКЛМНОПЯРСТУЖВЬЫЗШЭЩЧЪ",
								data = koi7ru.indexOf(ascii);
							if(data < 0)
								return ascii;
						return String.fromCharCode(ascii + 0x60);
						}).split("");
						args.shift(); args.pop();
						while(args.length) {
							tmp = args.shift();
							code = tmp.charCodeAt(0);
							if(tmp == "\\")
								switch(tmp = args.shift()) {
								case	'0':	code = 0x00; break;
								case	't':	code = 0x09; break;
								case	'n':	code = 0x0A; break;
								case	'h':	code = 0x0C; break;
								case	'r':	code = 0x0D; break;
								case	'e':	code = 0x1B; break;
								case	'_':	code = 0x1F; break;
								case	'<':	code = 0x08; break;
								case	'>':	code = 0x18; break;
								case	'^':	code = 0x19; break;
								case	'v':	code = 0x1A; break;
								default:	code = tmp.charCodeAt(0);
								}
							debug.text[ip] = true,
							bin[ip ++] = code;
						}
					} else
						while(args.length)
							debug.text[ip] = true,
							bin[ip ++] = args.shift();
					continue;
				case	".DW":
					while(args.length)
						tmp = args.shift(),
						debug.text[ip] = true,
						bin[ip ++] = tmp.lo(),
						debug.text[ip] = true,
						bin[ip ++] = tmp.hi();
					continue;
				}
				hlt = !lap;
				if(code >= 0) {
					do {
						if(!files)
							debug.halt[ip] &= hlt;
						debug.text[ip] = false,
						bin[ip ++] = code & 0xFF;
						while(bytes -- && args.length > 0)
							debug.text[ip] = false,
							debug.halt[ip] = false,
							bin[ip ++] = args.shift();
					} while((code & 0x8000) && (code >>= 16));
				}
				if(files && !lap && ip >= 0 && file.end < end)
					file.end = ip;
			}
		} while(lap --);
		document.title = title;
		//disassm();
		if(files)
			return file;
	}
	// Initializing start / Начало инициализации
	function create(pattern) {
		var	res, tmp, id;
		var	$D, commands, operands, actions, descriptions, width;
		// Styling collection / Коллекция стилей
		var	stylex	= /^\.([a-z]+)\t+(.+?)\t+/gm;
		// Registers collection / Коллекция регистров
		var	regs	= [],
			regex	= /^([a-z]+)(?:\:)(0x[0-9A-F]+|0[0-7]+|\d+)\t(.*)\t(.*)/gm;
		// Operands collection / Коллекция набора операндов
		var	opers	= [],
			operex	= /^([^\s-]{2,14})\t(.*)$/gm,
			operexp	= [],
			operact	= [],
			operem	= [];
		// Decoder bits collection / Коллекция битов дешифратора
		var	pins	= [],
			pinex	= /^([A-Z_?]+|[0-7_?]+)\?$/gm,
			pinexp	= [],
			pinenum	= [],
			pinenus	= [];
		// Instructions set model /  Коллекция командной модели
		var	models	= [],
			modelex	= /^([0X1_]+)([A-Z_?])\t([^:\t]+)\t*([^:\t]*?)\t*:(.*?)(?:\t+(.*))?$/gm;
		// Destroy the existing model / Уничтожаем существующую модель
		core.ready = false;
		delete	core.actions;
		delete	core.commands;
		delete	debug.labels;
		delete	debug.data;
		core.actions = {},
		core.commands = {},
		debug.labels = [],
		debug.data = [],
		r = {},
		core.is_active = false;
		// Let's parse the presentable pattern / Начинаем разбирать представленный шаблом
		if(!(res = pattern.match(regex))) {
			console.log(CPU_ID + ": Registers declaration needed...");
			alert("Where the registers?");
			throw	1;
		}
		// Build-up the registers / Создаём набор регистров
		console.groupCollapsed(CPU_ID + ": Registers set");
		res.forEach
		(function(str) {
			str.replace(regex,
			function(str, id, data, name, present) {
				if(id != "assm")
					r[id] = new Register(parseInt(data)),
					r[id].id = name;
				tmp = [];
				present.replace(/\`(.+?)\`|([^`]+?)/g,
				function(str, action, text) {
					if(text)
						tmp.push('"' + text + '"');
					else
						tmp.push("(" + action + ")");
				});
				if(id == "assm")
					debug.lines = parseInt(data),
					debug.string = present;
				else
					r[id].show = tmp.join("+");//new Function("", "return " + tmp.join("+"));
			});
			console.log(str);
		});
		console.groupEnd();
		if(!(res = pattern.match(pinex))) {
			console.log(CPU_ID + ": Binaries declaration needed...");
			alert("Where the pins?");
			throw	2;
		}
		console.groupCollapsed(CPU_ID + ": Decoder bus naming");
		pinex = [];
		// Build-up the decoder / Разбираем битовые поля инструкций
		res.forEach
		(function(str) {
			str.replace(/_|\?$/g, "").split("").reverse()
			.forEach
			(function(id, x, whole) {
				if(isFinite(id))
					pinenum.push("((x >> " + (whole.length - x - 1) + ") & 1) << " + id),
					pinenus.push("x.substr(" + (-x - 1) + ", 1)");
				else
				if(id != "?")
					(((pinexp[id]) || (pinexp[id] = [])) && pinexp[id]).push("(((x >> " + x + ") & 1) << " + pinexp[id].length + ")");
			});
			// Functional evaluating / Объявляем функциональное считывание
			console.log(str);
		});
		console.groupEnd();
		for(id in pinexp)
			pinex.push("\\$" + id + "(\\[.*?\\])?"),
			pins["$" + id] = new Function("x", "return " + pinexp[id].join(" | "));
		if(pinenum.length)
			pinenum = new Function("x", "return (" + pinenum.join(") + (") + ")"),
			pinenus = new Function("x", "return " + pinenus.join(" + "));
		else
			pinenum = new Function("x", "return x"),
			pinenus = new Function("x", "return x");
		// Decoder bits collection / Собираем имена полей в выражение
		pinex = new RegExp("(" + pinex.join("|") + ")", "g");
		if(!(res = pattern.match(operex))) {
			console.log(CPU_ID + ": Operands declaration needed...");
			alert("Where the operands?");
			throw	3;
		}
		console.groupCollapsed(CPU_ID + ": Operands set");
		// Parse the operands / Разбираемся с операндами
		res.forEach
		(function(str) {
			var	str = str.split(/\t+/);
			var	val = str[1].split("/");
			str[0].split("/")
			.forEach
			(function(id) {
				console.log(id + '\t' + val[0]);
				operexp.push(id);
				opers[id] = val[0];
				operact[id] = str[2];
				operem[id] = str[3] || val[0];
				if(val[1])
					val.shift();
				if(id.match(/^_+\d$/) && str[3])
					debug.data[str[1]] = str[3];
			});
			console.log(str);
		});
		console.groupEnd();
		// Collect the operands names into expression / Собираем имена операндов в выражение
		//operex = new RegExp("(" + operexp.join("|")./*replace(/_+\d\||\|_+\d/g, "").*/replace(/(\$|\.)/g, "\\$1") + ")", "g");
		operexp = new RegExp("(" + operexp.join("|").replace(/(\$|\.)/g, "\\$1") + ")", "g");
		// Instructions presentable styles collection / Коллекция стилей презентабельности инструкций
		for(id = 0; id < 8; ++ id)
			user.styles.zip[id] = "";
		if(!!(res = pattern.match(stylex))) {
			console.groupCollapsed(CPU_ID + ": Instructions styling...");
			res.forEach
			(function(str) {
				str.replace(stylex,
				function(str, id, style) {
						console.log("Bad style index " + id + " " + style);
					if((id in user.styles) && isFinite(id = user.styles[id])) {
						id = +id;
						tmp = id < 3 ? 1 << id : 4;
						while(id < 8)
							user.styles.zip[id] = style,
							id += tmp;
					} 
				});
			});
			console.groupEnd();
		} else
			console.log(CPU_ID + ": Styling declaration advisable...");
		// Build-up the fully command model / Разбираемся и строим полную командную модель
		if(!(res = pattern.match(modelex))) {
			console.log(CPU_ID + ": Common model declaration needed...");
			alert("Where the model???");
			throw	4;
		}
		this.r = r;
		this.m = m;
		if(step.actions)
			delete	step.actions;
		this.step = step;
		step.actions = [];
		//this.step.r = r;
		step();
		console.groupCollapsed(CPU_ID + ": Building model");
		res.forEach
		(function(desc) {
			console.groupCollapsed(desc);
			desc.replace(modelex,
			function(str, mask, group, command, operand, action, description) {
				tmp = pinenus(mask.replace(/_/g, ""));
				var
					base = parseInt(tmp.replace(/X/g, "0"), 2),	// 0XX1X0X1XX -> 0001000100
					over = parseInt(tmp.replace(/X/g, "1"), 2),	// 0XX1X0X1XX -> 0111101111
					last = parseInt(tmp.replace(/./g, "1"), 2),	// 0XX1X0X1XX -> 1111111111
					mix = base ^ over ^ last;			//               1001010100
				// Running for whole combinates of undefined bits / Пробегаем по всем комбинациям неопределённых битов
				for(var i = base; i <= over; i = (((i | mix) + 1) & ~mix) | base) {
					$D = (i & -256) | pinenum(i);
					if(core.actions[$D])
						continue;
					if(width = operand.match(/_(\d)/))
						width = +width[1];
					else
						width = 0;
					// Enumeration correct the pattern fields / Корректируем объявления шаблона с подстановкой конкретных числовых величин
					commands	= command	.replace(pinex	,function($id)	{return	pins[$id]($D);	});
					operands	= operand	.replace(pinex	,function($id)	{return	pins[$id]($D);	});
					actions		= action	.replace(pinex	,function($id)	{return	pins[$id]($D);	});
					descriptions	= description	.replace(pinex	,function($id)	{return	pins[$id]($D);	});
					// Second lap correction / Проходимся второй раз с подстановкой перечисленных имён шаблона конкретными ссылками
					commands	= commands	.replace(operexp,function($id)	{return	opers[$id.replace(/\[.*?\]/, "")];	});
					operands	= operands	.replace(operexp,function($id)	{return	opers[$id.replace(/\[.*?\]/, "")];	});
					actions		= actions	.replace(operexp,function($id)	{return	operact[$id.replace(/\[.*?\]/, "")];	});
					descriptions	= descriptions	.replace(operexp,function($id)	{return	operem[$id.replace(/\[.*?\]/, "")];	});
					Logging.push($D.toHex(2) + "#" + group + "|" + commands + "\t" + operands + "\t{" + actions + "}" + descriptions);
					// Emulator step-in expression / Ищем ходовую строчку эмулятора
					if(group == "?") {
						if((command + " " + operand) == CPU_ID)
							$D = CPU_ID;
						else {
							console.groupEnd(); console.groupEnd();
							console.log(CPU_ID + ": Model version is incorrect...");
							alert("Incorrect version...");
							throw	5;
						}
					}
					// Building the functional matrix for emulator and disassembler / Строим функциональную матрицу системы команд для эмуляции и дизассемблера
					core.actions[$D] = {
						color	: group,	// Instructions group colour / Цвет группы, к которой относится операция
						width	: width + 1,	// Width of instruction / Ширина инструкции
						command	: commands,	// Instruction mnemonic / Название команды
						operand	: operands,	// Operands of instruction / Операнды команды
						action	: actions,	// Emulation expression / Функциональное описание действия команды
						remark	: descriptions,	// Description / Краткое описание инструкции
					};
					step.actions[$D] = new Function("", "with(this){return " + actions + "}");
					if(group == "?")
						break;
					if(!core.commands[commands])
						core.commands[commands] = [];
					// Building the callback matrix for assembly / Строим обратную матрицу для ассемблера
					operands.replace(/_+/g, "_").split("/")
					.forEach(function(operands) {
						if(!(operand in core.commands[commands]))
							core.commands[commands][operands] = $D;
					});
					tmp = last + 1;
					console.log(mask.replace(/[0X1]/g, function() {
							return	(tmp >>= 1) & $D ? "1" : "0";
						}) + "\t" + width + ":" + commands + "\t" + operands + "\t:" + actions + "\t/*" + descriptions + "*/");
				};
			});
			console.groupEnd();
		});
		console.groupEnd();
		console.log(CPU_ID + ": Model is builded and ready...");
		core.ready = true;
		this.r = r;
		clearTimeout(debug.hTimer);
		debug.hTimer = setTimeout(step.bind(this), 1000 / core.clock);
	}
	return	{
		core		: core,
		assembly	: assembly,
		disassm		: disassm,
		reset		: reset,
		step		: step,
		debug		: debug,
		watch		: watch,
		create		: create,
		r		: r,
//		get r()		{
//			return	r;
//		},
		set	command_set(e)	{
			if(typeof e == typeof Number) {
				alert(e + '[]' );
				command_set(e, 0);
			} else
			if(typeof e == typeof []) {
			//	alert('[--]' + e);
				user.actions = e;
			} else
			if(typeof e == typeof {}) {
				alert('-{}-' + e);
			} else
				user.actions = e;
		},
		set	showListing(e) {
		user.disassemblies = e;
		},
		ram	: function(handle, data) {
			var	ok = false;
			var	addr;
			if(isFinite(handle) && typeof handle == "number") {
				addr = handle;
				if(isFinite(data)) {
					console.log("#/RAM/[%04X]=%02X", addr, data);
					return	m[addr & 0xFFFF] = data;
				} else {
					data = DB(addr);
					console.log("#/RAM/[%04X]:%02X", addr, data);
					return	data;
				}
			} else
			if(typeof handle == typeof "") {
				addr = data;
				for(data = 0; data < handle.length; ++ addr, ++ data)
					m[addr] = handle.charCodeAt(data);
				ok = true;
			} else
			if(handle) {
				try {
					m = handle;
					for(addr = 0; addr < 65536; ++ addr)
						//trace.halt[addr] = false,
						m[addr] = isFinite(data) ? data : (Math.random() * 128 & 127) + 64;
					console.log("#/RAM/Initializing successful for %d bytes", addr);
					ok = true;
				} catch(e) {
					console.log("@/Initializing crashed... %d", 5);
				}
			} else
				return	m;
			if(!ok)
				throw new Error("654");
			return	true;
		}
	};
};
var	Roller=0,date=new Date();
function display(core) {
	var	roller = Roller ++;
	Roller %= cpu.debug.flash;
	var	row = [], ram, i, p, h, w, x, y, cx = -1, cy = -1, c, d, u, f = 7, g = 0, col = 7, gnd = 0, s = "";
	var	oldSeconds = date.getSeconds();
	date = new Date();
	core.debug.stamps[1] = date.getTime();
	var	ms = (date.getMilliseconds() % 500 > 250);
	if(date.getSeconds() != oldSeconds)
		;//core.IRQ(core.DO_FORCE);
	setTimeout(display, 1000 / cpu.debug.flash, cpu);
	ram = core.ram();
	cx = ram[0x76CF].lo(), cy = ram[0x76CE].lo();
/*	if(document.getElementById("Display").style.display != "none") {
		w = 78, h = 30;
		x = 0, y = 0, p = 0x76D0;
		f <<= 4, g <<= 4;
		while(y < h) {
			roller ++;
			c = ram[p];
			d = c & 255;
			if(d >= 0x80 && d <= 0x87)
				f = (c & 7) << 4;
			if(d >= 0x90 && d <= 0x97)
				g = (c & 7) << 4;
			d = x == cx && y == cy ? 0 : 8;
			if((c < 255 || d == 0)) {
				c &= 255;
				d = ms ? d | 8 : d;
					core.watch.c2d.drawImage(core.watch.fontCnv, c * 16 + 2, 8 ^ g ^ d, 6, 8, x * 6, y * 8, 6, 8),
					core.watch.c2d.drawImage(core.watch.fontCnv, c * 16 + 2, 0 ^ f ^ d, 6, 8, x * 6, y * 8, 6, 8);
				ram[p] = ms || !d ? c : c | 256;
			}
			ram[p] = c | 256;
			if(++ x >= w)
				f = 7 << 4,
				g = 0 << 4,
				x = 0,
				++ y;
			++ p;
		}
	}/* else */{
		for(i = 0, w = 78, h = 30, x, y, c, u; i < w * h * 1; ++ i)
			x = i % w, y = Math.floor(i / w),
			c = ram[(i + 0x76D0) & 0xFFFF],
			ram[(i + 0x76D0) & 0xFFFF] = (c | 256),
			u = c < 256 ? "<span style=color:red>" : (c &= 255, "<span>"),
			row[y] = (x ? row[y] : "") + u +
				(x == ram[0x76CF].lo() && y == ram[0x76CE].lo() && (new Date()).getMilliseconds() % 500 > 250
					? "<u>&#" + (c < 32 || c > 127 ? 0xB7 : c == 127 ? 0x2588 : c) + ";</u>"
					: "&#" + (c < 32 || c > 127 ? 0xB7 : c == 127 ? 0x2588 : c) + ";") + "</span>";
		document.getElementById("Screen").innerHTML = row.join("<br />");//ram.Chr(0x76D0, 78, 30, (new Date()).getMilliseconds() % 500 > 250 ? ram[0x76CF] + ram[0x76CE] * 78 : -1);//row.join("<br />");
	}/**/
	c = core.watch.iAdjust, i = 1;
	document.getElementById("state").innerHTML = [   "FPS: IPC: IPS: ".replace(/([A-Z]+)/g, function(str, tag) { return ++ i && c -- ? tag : "<u>" + (s = tag) + "</u>"; }),
							("  " + core.debug.flash).substr(-2) + " "
							+  ("     " + core.core.scale).substr(-6) + " "
								+ ("   " + core.core.clock).substr(-4)
					].join("\r\n");
	core.watch.nAdjust = i,
	core.watch.sAdjust = s;
	if(!core.core.is_active)
		core.watch.dirty = 7;
	if(core.watch.dirty > 0)
		-- core.watch.dirty,
		core.disassm();
	if(core.debug.stamps[0] >= 0) {
		i = Math.floor((core.debug.stamps[1] - core.debug.stamps[0]) / 1000);
		//document.getElementById("Context").innerText = core.CR(0).Hex(2) + "#" + ("0" + Math.floor(i / 60)).substr(-2) + ":" + ("0" + (i % 60)).substr(-2);
	}
	//core.watch.active = core.watch.active.toUpperCase();
	//core.disassm();
	//document.getElementById("Dumper").innerHTML = this.state.isHalt || !this.state.isRun || this.state.scale == 1 || this.state.isHint ? this.r.ex.Dump() : "";
}

var
mon32=
"\xC3\x36\xF8\xC3\x63\xFE\xC3\x98\xFB\xC3\xBA\xFC\xC3\x46\xFC\xC3" +
"\xBA\xFC\xC3\x01\xFE\xC3\xA5\xFC\xC3\x22\xF9\xC3\x72\xFE\xC3\x7B" +
"\xFA\xC3\x7F\xFA\xC3\xB6\xFA\xC3\x49\xFB\xC3\x16\xFB\xC3\xCE\xFA" +
"\xC3\x52\xFF\xC3\x56\xFF\x3E\x8A\x32\x03\x80\x31\xCF\x76\xCD\xCE" +
"\xFA\x21\x00\x76\x11\x5F\x76\x0E\x00\xCD\xED\xF9\x21\xCF\x76\x22" +
"\x1C\x76\x21\x5A\xFF\xCD\x22\xF9\xCD\xCE\xFA\x21\xFF\x75\x22\x31" +
"\x76\x21\x2A\x1D\x22\x2F\x76\x3E\xC3\x32\x26\x76\x31\xCF\x76\x21" +
"\x66\xFF\xCD\x22\xF9\x32\x02\x80\x3D\x32\x02\xA0\xCD\xEE\xF8\x21" +
"\x6C\xF8\xE5\x21\x33\x76\x7E\xFE\x58\xCA\xD3\xFF\xFE\x55\xCA\x00" +
"\xF0\xF5\xCD\x2C\xF9\x2A\x2B\x76\x4D\x44\x2A\x29\x76\xEB\x2A\x27" +
"\x76\xF1\xFE\x44\xCA\xC5\xF9\xFE\x43\xCA\xD7\xF9\xFE\x46\xCA\xED" +
"\xF9\xFE\x53\xCA\xF4\xF9\xFE\x54\xCA\xFF\xF9\xFE\x4D\xCA\x26\xFA" +
"\xFE\x47\xCA\x3F\xFA\xFE\x49\xCA\x86\xFA\xFE\x4F\xCA\x2D\xFB\xFE" +
"\x4C\xCA\x08\xFA\xFE\x52\xCA\x68\xFA\xC3\x00\xF0\x3E\x33\xBD\xCA" +
"\xF1\xF8\xE5\x21\x9E\xFF\xCD\x22\xF9\xE1\x2B\xC3\xF3\xF8\x21\x33" +
"\x76\x06\x00\xCD\x63\xFE\xFE\x08\xCA\xDC\xF8\xFE\x7F\xCA\xDC\xF8" +
"\xC4\xB9\xFC\x77\xFE\x0D\xCA\x1A\xF9\xFE\x2E\xCA\x6C\xF8\x06\xFF" +
"\x3E\x52\xBD\xCA\xAE\xFA\x23\xC3\xF3\xF8\x78\x17\x11\x33\x76\x06" +
"\x00\xC9\x7E\xA7\xC8\xCD\xB9\xFC\x23\xC3\x22\xF9\x21\x27\x76\x11" +
"\x2D\x76\x0E\x00\xCD\xED\xF9\x11\x34\x76\xCD\x5A\xF9\x22\x27\x76" +
"\x22\x29\x76\xD8\x3E\xFF\x32\x2D\x76\xCD\x5A\xF9\x22\x29\x76\xD8" +
"\xCD\x5A\xF9\x22\x2B\x76\xD8\xC3\xAE\xFA\x21\x00\x00\x1A\x13\xFE" +
"\x0D\xCA\x8E\xF9\xFE\x2C\xC8\xFE\x20\xCA\x5D\xF9\xD6\x30\xFA\xAE" +
"\xFA\xFE\x0A\xFA\x82\xF9\xFE\x11\xFA\xAE\xFA\xFE\x17\xF2\xAE\xFA" +
"\xD6\x07\x4F\x29\x29\x29\x29\xDA\xAE\xFA\x09\xC3\x5D\xF9\x37\xC9" +
"\x7C\xBA\xC0\x7D\xBB\xC9\xCD\xA4\xF9\xCD\x90\xF9\xC2\xA2\xF9\x33" +
"\x33\xC9\x23\xC9\xCD\x72\xFE\xFE\x03\xC0\xCD\xCE\xFA\xC3\xAE\xFA" +
"\xE5\x21\x6C\xFF\xCD\x22\xF9\xE1\xC9\x7E\xC5\xCD\xA5\xFC\x3E\x20" +
"\xCD\xB9\xFC\xC1\xC9\xCD\x78\xFB\xCD\xB9\xF9\xCD\x96\xF9\x7D\xE6" +
"\x0F\xCA\xC5\xF9\xC3\xC8\xF9\x0A\xBE\xCA\xE6\xF9\xCD\x78\xFB\xCD" +
"\xB9\xF9\x0A\xCD\xBA\xF9\x03\xCD\x96\xF9\xC3\xD7\xF9\x71\xCD\x99" +
"\xF9\xC3\xED\xF9\x79\xBE\xCC\x78\xFB\xCD\x96\xF9\xC3\xF4\xF9\x7E" +
"\x02\x03\xCD\x99\xF9\xC3\xFF\xF9\xCD\x78\xFB\x7E\xB7\xFA\x15\xFA" +
"\xFE\x20\xD2\x17\xFA\x3E\x2E\xCD\xB9\xFC\xCD\x96\xF9\x7D\xE6\x0F" +
"\xCA\x08\xFA\xC3\x0B\xFA\xCD\x78\xFB\xCD\xB9\xF9\xE5\xCD\xEE\xF8" +
"\xE1\xD2\x3B\xFA\xE5\xCD\x5A\xF9\x7D\xE1\x77\x23\xC3\x26\xFA\xCD" +
"\x90\xF9\xCA\x5A\xFA\xEB\x22\x23\x76\x7E\x32\x25\x76\x36\xF7\x3E" +
"\xC3\x32\x30\x00\x21\xA2\xFF\x22\x31\x00\x31\x18\x76\xC1\xD1\xE1" +
"\xF1\xF9\x2A\x16\x76\xC3\x26\x76\x3E\x90\x32\x03\xA0\x22\x01\xA0" +
"\x3A\x00\xA0\x02\x03\xCD\x99\xF9\xC3\x6D\xFA\x2A\x02\x76\xC9\xE5" +
"\x2A\x00\x76\x7E\xE1\xC9\x3A\x2D\x76\xB7\xCA\x91\xFA\x7B\x32\x2F" +
"\x76\xCD\xB6\xFA\xCD\x78\xFB\xEB\xCD\x78\xFB\xEB\xC5\xCD\x16\xFB" +
"\x60\x69\xCD\x78\xFB\xD1\xCD\x90\xF9\xC8\xEB\xCD\x78\xFB\x3E\x3F" +
"\xCD\xB9\xFC\xC3\x6C\xF8\x3E\xFF\xCD\xFF\xFA\xE5\x09\xEB\xCD\xFD" +
"\xFA\xE1\x09\xEB\xE5\xCD\x0A\xFB\x3E\xFF\xCD\xFF\xFA\xE1\xE5\x21" +
"\x01\xC0\x36\x00\x2B\x36\x4D\x36\x1D\x36\x99\x36\x93\x23\x36\x27" +
"\x7E\x7E\xE6\x20\xCA\xE1\xFA\x21\x08\xE0\x36\x80\x2E\x04\x36\xD0" +
"\x36\x76\x2C\x36\x23\x36\x49\x2E\x08\x36\xA4\xE1\xC9\x3E\x08\xCD" +
"\x98\xFB\x47\x3E\x08\xCD\x98\xFB\x4F\xC9\x3E\x08\xCD\x98\xFB\x77" +
"\xCD\x99\xF9\xC3\x0A\xFB\x01\x00\x00\x7E\x81\x4F\xF5\xCD\x90\xF9" +
"\xCA\x9F\xF9\xF1\x78\x8E\x47\xCD\x99\xF9\xC3\x19\xFB\x79\xB7\xCA" +
"\x35\xFB\x32\x30\x76\xE5\xCD\x16\xFB\xE1\xCD\x78\xFB\xEB\xCD\x78" +
"\xFB\xEB\xE5\x60\x69\xCD\x78\xFB\xE1\xC5\x01\x00\x00\xCD\x46\xFC" +
"\x05\xE3\xE3\xC2\x4D\xFB\x0E\xE6\xCD\x46\xFC\xCD\x90\xFB\xEB\xCD" +
"\x90\xFB\xEB\xCD\x86\xFB\x21\x00\x00\xCD\x90\xFB\x0E\xE6\xCD\x46" +
"\xFC\xE1\xCD\x90\xFB\xC3\xCE\xFA\xC5\xCD\xB0\xF9\x7C\xCD\xA5\xFC" +
"\x7D\xCD\xBA\xF9\xC1\xC9\x4E\xCD\x46\xFC\xCD\x99\xF9\xC3\x86\xFB" +
"\x4C\xCD\x46\xFC\x4D\xC3\x46\xFC\xE5\xC5\xD5\x57\x3E\x80\x32\x08" +
"\xE0\x21\x00\x00\x39\x31\x00\x00\x22\x0D\x76\x0E\x00\x3A\x02\x80" +
"\x0F\x0F\x0F\x0F\xE6\x01\x5F\xF1\x79\xE6\x7F\x07\x4F\x26\x00\x25" +
"\xCA\x34\xFC\xF1\x3A\x02\x80\x0F\x0F\x0F\x0F\xE6\x01\xBB\xCA\xBF" +
"\xFB\xB1\x4F\x15\x3A\x2F\x76\xC2\xDC\xFB\xD6\x12\x47\xF1\x05\xC2" +
"\xDD\xFB\x14\x3A\x02\x80\x0F\x0F\x0F\x0F\xE6\x01\x5F\x7A\xB7\xF2" +
"\x0B\xFC\x79\xFE\xE6\xC2\xFF\xFB\xAF\x32\x2E\x76\xC3\x09\xFC\xFE" +
"\x19\xC2\xB7\xFB\x3E\xFF\x32\x2E\x76\x16\x09\x15\xC2\xB7\xFB\x21" +
"\x04\xE0\x36\xD0\x36\x76\x23\x36\x23\x36\x49\x3E\x27\x32\x01\xC0" +
"\x3E\xE0\x32\x01\xC0\x2E\x08\x36\xA4\x2A\x0D\x76\xF9\x3A\x2E\x76" +
"\xA9\xC3\xA1\xFC\x2A\x0D\x76\xF9\xCD\xCE\xFA\x7A\xB7\xF2\xAE\xFA" +
"\xCD\xA4\xF9\xC3\x9C\xFB\xE5\xC5\xD5\xF5\x3E\x80\x32\x08\xE0\x21" +
"\x00\x00\x39\x31\x00\x00\x16\x08\xF1\x79\x07\x4F\x3E\x01\xA9\x32" +
"\x02\x80\x3A\x30\x76\x47\xF1\x05\xC2\x66\xFC\x3E\x00\xA9\x32\x02" +
"\x80\x15\x3A\x30\x76\xC2\x7A\xFC\xD6\x0E\x47\xF1\x05\xC2\x7B\xFC" +
"\x14\x15\xC2\x58\xFC\xF9\x21\x04\xE0\x36\xD0\x36\x76\x23\x36\x23" +
"\x36\x49\x3E\x27\x32\x01\xC0\x3E\xE0\x32\x01\xC0\x2E\x08\x36\xA4" +
"\xF1\xD1\xC1\xE1\xC9\xF5\x0F\x0F\x0F\x0F\xCD\xAE\xFC\xF1\xE6\x0F" +
"\xFE\x0A\xFA\xB7\xFC\xC6\x07\xC6\x30\x4F\xF5\xC5\xD5\xE5\xCD\x01" +
"\xFE\x21\x85\xFD\xE5\x2A\x02\x76\xEB\x2A\x00\x76\x3A\x04\x76\x3D" +
"\xFA\xEE\xFC\xCA\x65\xFD\xE2\x73\xFD\x79\xD6\x20\x4F\x0D\xFA\xE9" +
"\xFC\xC5\xCD\xB9\xFD\xC1\xC3\xDD\xFC\xAF\x32\x04\x76\xC9\x79\xE6" +
"\x7F\x4F\xFE\x1F\xCA\xA3\xFD\xFE\x0C\xCA\xB2\xFD\xFE\x0D\xCA\xF3" +
"\xFD\xFE\x0A\xCA\x47\xFD\xFE\x08\xCA\xD6\xFD\xFE\x18\xCA\xB9\xFD" +
"\xFE\x19\xCA\xE2\xFD\xFE\x1A\xCA\xC5\xFD\xFE\x1B\xCA\x9E\xFD\xFE" +
"\x07\xC2\x38\xFD\x01\xF0\x05\x78\xFB\x3D\xC2\x28\xFD\x78\xF3\x3D" +
"\xC2\x2E\xFD\x0D\xC2\x27\xFD\xC9\x71\xCD\xB9\xFD\x7A\xFE\x03\xC0" +
"\x7B\xFE\x08\xC0\xCD\xE2\xFD\x7A\xFE\x1B\xC2\xC5\xFD\xE5\xD5\x21" +
"\xC2\x77\x11\x10\x78\x01\x9E\x07\x1A\x77\x23\x13\x0B\x79\xB0\xC2" +
"\x58\xFD\xD1\xE1\xC9\x79\xFE\x59\xC2\xE9\xFC\xCD\xB2\xFD\x3E\x02" +
"\xC3\xEA\xFC\x79\xD6\x20\x4F\x0D\x3E\x04\xFA\xEA\xFC\xC5\xCD\xC5" +
"\xFD\xC1\xC3\x77\xFD\x22\x00\x76\xEB\x22\x02\x76\x3E\x80\x32\x01" +
"\xC0\x7D\x32\x00\xC0\x7C\x32\x00\xC0\xE1\xD1\xC1\xF1\xC9\x3E\x01" +
"\xC3\xEA\xFC\x21\xF4\x7F\x11\x25\x09\xAF\x77\x2B\x1B\x7B\xB2\xC2" +
"\xA9\xFD\x11\x08\x03\x21\xC2\x77\xC9\x7B\x23\x1C\xFE\x47\xC0\x1E" +
"\x08\x01\xC0\xFF\x09\x7A\xFE\x1B\x01\x4E\x00\xC2\xD3\xFD\x16\x02" +
"\x01\xB0\xF8\x14\x09\xC9\x7B\x2B\x1D\xFE\x08\xC0\x1E\x47\x01\x40" +
"\x00\x09\x7A\xFE\x03\x01\xB2\xFF\xC2\xF0\xFD\x16\x1C\x01\x50\x07" +
"\x15\x09\xC9\x7D\x93\xD2\xF9\xFD\x25\x6F\x1E\x08\x01\x08\x00\x09" +
"\xC9\x3A\x02\x80\xE6\x80\xCA\x0E\xFE\x3A\x05\x76\xB7\xC0\xE5\x2A" +
"\x09\x76\xCD\x72\xFE\xBD\x6F\xCA\x2A\xFE\x3E\x01\x32\x0B\x76\x26" +
"\x15\xAF\x22\x09\x76\xE1\x32\x05\x76\xC9\x25\xC2\x21\xFE\x3C\xCA" +
"\x22\xFE\x3C\xCA\x51\xFE\xC5\x01\x03\x50\xCD\x27\xFD\xC1\x3A\x0B" +
"\x76\x26\xE0\x3D\x32\x0B\x76\xCA\x4C\xFE\x26\x40\x3E\xFF\xC3\x22" +
"\xFE\x3A\x02\x80\xE6\x80\xCA\x51\xFE\x3A\x06\x76\x2F\x32\x06\x76" +
"\xC3\x1A\xFE\xCD\x01\xFE\xB7\xCA\x63\xFE\xAF\x32\x05\x76\x3A\x09" +
"\x76\xC9\x3A\x02\x80\xE6\x80\xC2\x7D\xFE\x3E\xFE\xC9\xAF\x32\x00" +
"\x80\x32\x02\x80\x3A\x06\x76\xE6\x01\xF6\x06\x32\x03\x80\x3A\x01" +
"\x80\x3C\xC2\x97\xFE\x3D\xC9\xE5\x2E\x01\x26\x07\x7D\x0F\x6F\x2F" +
"\x32\x00\x80\x3A\x01\x80\x2F\xB7\xC2\xB3\xFE\x25\xF2\x9C\xFE\x3E" +
"\xFF\xE1\xC9\x2E\x20\x3A\x01\x80\x2F\xB7\xCA\xAF\xFE\x2D\xC2\xB5" +
"\xFE\x2E\x08\x2D\x07\xD2\xC3\xFE\x7C\x65\x6F\xFE\x01\xCA\xFA\xFE" +
"\xDA\xF3\xFE\x07\x07\x07\xC6\x20\xB4\xFE\x5F\xC2\x06\xFF\x3E\x20" +
"\xE1\xC9\x09\x0A\x0D\x7F\x08\x19\x18\x1A\x0C\x1F\x1B\x00\x01\x02" +
"\x03\x04\x05\x7C\x21\xEA\xFE\xC3\xFE\xFE\x7C\x21\xE2\xFE\x85\x6F" +
"\x7E\xFE\x40\xE1\xD8\xE5\x6F\x3A\x02\x80\x67\xE6\x40\xC2\x1A\xFF" +
"\x7D\xFE\x40\xFA\x3F\xFF\xE6\x1F\xE1\xC9\x3A\x06\x76\xB7\xCA\x2A" +
"\xFF\x7D\xFE\x40\xFA\x2A\xFF\xF6\x20\x6F\x7C\xE6\x20\xC2\x3F\xFF" +
"\x7D\xFE\x40\xFA\x3B\xFF\x7D\xEE\x20\xE1\xC9\x7D\xE6\x2F\x6F\x7D" +
"\xFE\x40\xE1\xF0\xE5\x6F\xE6\x0F\xFE\x0C\x7D\xFA\x50\xFF\xEE\x10" +
"\xE1\xC9\x2A\x31\x76\xC9\x22\x31\x76\xC9\x1F\x72\x61\x64\x69\x6F" +
"\x2D\x38\x36\x72\x6B\x00\x0D\x0A\x2D\x2D\x3E\x00\x0D\x0A\x18\x18" +
"\x18\x18\x00\x0D\x0A\x20\x50\x43\x2D\x0D\x0A\x20\x48\x4C\x2D\x0D" +
"\x0A\x20\x42\x43\x2D\x0D\x0A\x20\x44\x45\x2D\x0D\x0A\x20\x53\x50" +
"\x2D\x0D\x0A\x20\x41\x46\x2D\x19\x19\x19\x19\x19\x19\x00\x08\x20" +
"\x08\x00\x22\x16\x76\xF5\xE1\x22\x1E\x76\xE1\x2B\x22\x14\x76\x21" +
"\x00\x00\x39\x31\x1E\x76\xE5\xD5\xC5\x2A\x14\x76\x31\xCF\x76\xCD" +
"\x78\xFB\xEB\x2A\x23\x76\xCD\x90\xF9\xC2\x6C\xF8\x3A\x25\x76\x77" +
"\xC3\x6C\xF8\x21\x73\xFF\xCD\x22\xF9\x21\x14\x76\x06\x06\x5E\x23" +
"\x56\xC5\xE5\xEB\xCD\x78\xFB\xCD\xEE\xF8\xD2\xF6\xFF\xCD\x5A\xF9" +
"\xD1\xD5\xEB\x72\x2B\x73\xE1\xC1\x05\x23\xC2\xDE\xFF\xC9\xFF\xFF";
var	cpu = null;
var	ram = [];
var	VK = {
		BACK_SPACE	:0x08,
		TAB		:0x09,
		RETURN		:0x0D,
		BREAK		:0x13,
		CAPITAL		:0x14,
		ESC		:0x1B,
		PREV		:0x21,
		NEXT		:0x22,
		END		:0x23,
		HOME		:0x24,
		LEFT		:0x25,
		UP		:0x26,
		RIGHT		:0x27,
		DOWN		:0X28,
		PRINT		:0x2C,
		INSERT		:0x2D,
		DELETE		:0x2E,
		CONTEXT		:0x5D,
		NUMPAD0		:0x60,
		NUMPAD1		:0x61,
		NUMPAD2		:0x62,
		NUMPAD3		:0x63,
		NUMPAD4		:0x64,
		NUMPAD5		:0x65,
		NUMPAD6		:0x66,
		NUMPAD7		:0x67,
		NUMPAD8		:0x68,
		NUMPAD9		:0x69,
		F1		:0x70,
		F2		:0x71,
		F3		:0x72,
		F4		:0x73,
		F5		:0x74,
		F6		:0x75,
		F7		:0x76,	// Assembly
		F8		:0x77,
		F9		:0x78,	// Break point on/off
		F10		:0x79,
		F11		:0x7A,
		F12		:0x7B,
		BROWSE_BACK	:0xA6,
		BROWSE_FORWARD	:0xA7,
		BROWSE_REFRESH	:0xA8,
		BROWSE_STOP	:0xA9,
		BROWSE_SEARCH	:0xAA,
		BROWSE_HOME	:0xAC,
		PLAYER_FORWARD	:0xB0,	// Emulation IP ++
		PLAYER_REWIND	:0xB1,	// Emulation IP --
		PLAYER_STOP	:0xB2,	// Emulation stop/step
		PLAYER_PLAY	:0xB3,	// Emulation stop/start
		BROWSE_MAIL	:0xB4,
	};

function main() {;
	cpu = new CPU();
	cpu.ram(ram);
	cpu.command_set = (document.getElementById("Commands"));
	cpu.showListing = (document.getElementById("ByteCode"));
	//cpu.r=
	cpu.create(document.getElementById("Pattern").value);
	cpu.assembly(document.getElementById("Listing").value);
	display(cpu);
	document.getElementById("Pattern").focus();
	document.getElementById("Pattern").onkeydown =
	function(e) {
		if(e.keyCode == 13 && e.shiftKey) {
			//window.event.returnValue = false;
			cpu.create(this.value);
			//cpu.xyz = 9;
			cpu.assembly(document.getElementById("Listing").value);
			cpu.disassm();
			//cpu.command_set = {a:9, b:5};
			//cpu.command_set = [0x55, 1];
			//cpu.command_set = (0xAA, 1);
			cpu.step();
		}
		if(e.keyCode == 27) {
			if(e.shiftKey)
				cpu.core.is_active = !cpu.core.is_active;
			else
				cpu.debug.is_step = true;
			e.preventDefault();
		}
	}
	document.getElementById("Listing").onkeydown =
	function(e) {
		if(e.keyCode == 13 && e.shiftKey) {
			window.event.returnValue = false;
			cpu.assembly(document.getElementById("Listing").value);
		}
		if(e.keyCode == 27) {
			for(var i = 0; i < 1000; ++ i)
				cpu.step();
			cpu.step();
			e.preventDefault();
		}
	}
	document.getElementById("toListing").ondblclick =
	function(e) {
		cpu.assembly(document.getElementById("Listing").value);
	}
	document.getElementById("laModel").ondblclick =
	function(e) {
		cpu.create(document.getElementById("Pattern").value);
	}
	/*************************************/
	document.body.onkeydown = function(e) {
		//document.title = e.keyCode;
		switch(e.keyCode) {
		case	VK.UP:
			cpu.debug.choice --;
			e.preventDefault();
			break;
		case	VK.DOWN:
			cpu.debug.choice ++;
			e.preventDefault();
			break;
		case	VK.F9:	// Break-point
			if(e.shiftKey)
				cpu.debug.choice = cpu.r.pc.x;
			else
				cpu.debug.halt[cpu.debug.choice] = !cpu.debug.halt[cpu.debug.choice];
			cpu.disassm();
			e.preventDefault();
			break;
		case	VK.F1:		// Step
				cpu.debug.is_step = true;
			e.preventDefault();
//			window.event.returnValue = false;
			break;
		case	VK.F7:
			cpu.watch.iAdjust = (cpu.watch.iAdjust + 1) % cpu.watch.nAdjust;
			e.preventDefault();
			break;
		case	VK.F6:		// IP --
			switch(cpu.watch.sAdjust) {
			case	"FPS":
				cpu.debug.flash -= cpu.debug.flash > 1 ? 1 : 0;
				break;
			case	"IPS":
				cpu.core.clock >>= cpu.core.clock & 1 ? 0 : 1;
				break;
			case	"IPC":
				cpu.core.scale >>= cpu.core.scale & 1 ? 0 : 1;
				break;
			default:
				var	txt = document.getElementById("Logger").value.split(/\r?\n/).pop().toUpperCase().split(/[\s\t]+/);
				cpu.do_regs(txt[0], -1);
				cpu.core.is_active = false;
			}
			cpu.disassm();
			e.preventDefault();
			break;
		case	VK.F8:		// IP ++
			switch(cpu.watch.sAdjust) {
			case	"FPS":
				cpu.debug.flash += cpu.debug.flash < 50 ? 1 : 0;
				break;
			case	"IPS":
				cpu.core.clock <<= cpu.core.clock < 1000 ? 1 : 0;
				break;
			case	"IPC":
				cpu.core.scale <<= cpu.core.scale < 500000 ? 1 : 0;
				break;
			default:
				var	txt = document.getElementById("Listing").value.split(/\r?\n/).pop().toUpperCase().split(/[\s\t]+/);
				cpu.do_regs(txt[0], +1);
				cpu.core.is_active = false;
			}
			cpu.disassm();
			e.preventDefault();
			break;
		case	VK.F5:		// Assembly/Reset
			window.event.returnValue = false;
			if(e.ctrlKey)	// Reset
				cpu.reset(0xFF00);
			else		// Assembly
				cpu.core.is_active = false,
				cpu.assembly(document.getElementById("Listing").value);
			cpu.disassm();
			e.preventDefault();
			break;
		case	VK.F4:		// Start/Break emulation
			if(e.shiftKey)
				cpu.core.is_active = false;
			else
				cpu.core.is_active = !cpu.core.is_active;
			e.preventDefault();
			break;
		case	VK.F3:
			if(e.ctrlKey)
				cpu.stack(cpu.r.ip);
			else
			if(e.shiftKey)
				cpu.r.ip = cpu.stack();
			cpu.disassm();
			e.preventDefault();
			break;
		case	VK.RETURN:
			if(e.shiftKey);
			break;
		default:
			if(e.ctrlKey && e.keyCode > 48 && e.keyCode <= 56)
				cpu.CR(0, e.keyCode & 7);
		break;if(e.altKey && e.keyCode >= 48 && e.keyCode <= 55)
				cpu.command_set(e.keyCode & 7, false);
				//cpu.iox[0xFD].data(e.keyCode);
		}
	}
	document.body.onkeyup = function(e){
		switch(e.keyCode) {
		case	VK.F1:		// Help
		case	VK.F3:		// Push/Pop
		case	VK.F5:		// Assembly
		case	VK.F6:
		case	VK.F7:
		case	VK.F8:
			window.event.returnValue = false;
			e.preventDefault();
			break;
		default:
			//cpu.iox[0xFD].data(0xFF); break;
		}
	}
	cpu.ram(mon32, 0xF800);
	// Auto-Run
	cpu.reset();
	cpu.core.is_active = true;
	cpu.debug.is_step = false;
	cpu.core.clock = 1024;
	cpu.core.scale = 512;
}
</script>
<style>
body	{
	background-color: black;
	color		:lightgreen;
}
pre#Commands, #Coding	{
	color		: lightgreen;
	cursor		: default;
}
span.active {
	text-decoration	: overline underline;
}
span.halted {
	cursor		: cell;
	text-decoration	: line-through;
}
span.user {
	cursor		: cell;
	color		: silver !important;
	text-decoration	: overline underline;
}
span.CPU_Group__{
	background-color: #012;
	cursor		: pointer;
}
span.CPU_Group_A{
	background-color: #772;	/*ALU*/
}
span.CPU_Group_B{
	background-color: #764;	/*JMP*/
}
span.CPU_Group_C{
	background-color: #888;	/*HLT*/
}
span.CPU_Group_D{
	background-color: #652;	/*INX*/
}
span.CPU_Group_E{
	background-color: #363;	/*POP*/
}
span.CPU_Group_F{
	background-color: #367;	/*MOV*/
}
span.CPU_Group_X{
	background-color: #437;	/*???*/
}
span.CPU_Group_A_{
	background-color: #EE4;	/*ALU*/
	color		: darkgreen;
}
span.CPU_Group_B_{
	background-color: #EC8;	/*JMP*/
	color		: darkgreen;
}
span.CPU_Group_C_{
	background-color: #FFF;	/*HLT*/
	color		: darkgreen;
}
span.CPU_Group_D_{
	background-color: #CA4;	/*INX-*/
	color		: darkgreen;
}
span.CPU_Group_E_{
	background-color: #6C6;	/*POP*/
	color		: darkgreen;
}
span.CPU_Group_F_{
	background-color: #6CE;	/*MOV*/
	color		: darkgreen;
}
span.CPU_Group_X_{
	background-color: #86E;	/*???*/
	color		: darkgreen;
}
span.CPU_Dump_B	{
	background-color: #363;	/*???*/
	color		: lightgreen;
	text-decoration	: italic;
}
textarea#Pattern	{
	opacity		: 0.95;
}
input[type=radio],
input[type=radio] + label ~ textarea,
input#toK + label ~ textarea#k,
input#toListing + label ~ textarea#Listing,
input#toModel + label ~ textarea#Pattern {
	display	:none;
}
input#toListing:checked + label ~ textarea#Listing,
input#toModel:checked + label ~ textarea#Pattern {
	display	:block;
}
input + label {
	border			: medium buttonface outset;
	background-color	: buttonface;
	color			: buttontext;
}
input:checked + label {
	border-top-style	: inset;
	border-left-style	: inset;
	border-right-style	: inset;
	border-bottom-color	: transparent;
	background-color	: transparent;
	color			: lightgreen;
}
</style>
</head>
<body onload='main()'>
<table>
<tr valign=top><td>
<p>
<input type=radio name=Viewer id=toKnot><label for=toKnot accessKey=K>&#9776;</label>
<input type=radio name=Viewer id=toListing><label for=toListing accessKey=L>&#9776;Listing</label>
<input type=radio name=Viewer id=toModel><label id=laModel for=toModel accessKey=M>&#9939;Matrix</label>
<button id=Reset accessKey=R onclick='cpu.ram(mon32, 0xF800); cpu.reset()' title='[ALT+R] Reload "Monitor"'>Reset</button>
<button id=Start accessKey=S onclick='cpu.core.is_active = true; cpu.debug.is_step = false;'>Start</button>
<button id=Trace accessKey=T onclick='cpu.debug.is_step = true;'>Trace</button>
<button id=Start accessKey=S onclick='cpu.ram(mon32, 0xF800); cpu.reset(); cpu.core.is_active = true; cpu.debug.is_step = false; cpu.core.clock = 1024; cpu.core.scale = 512;'>Auto</button>
<textarea id=Listing rows=32 cols=128 style=position:absolute>
; File Name                       monitor.bin
; Format                          Binary
; Base Address: 0000h Range: F800h - 10000h Loaded length: 0800h

; Processor:        Intel 8080/8085
; Target assembler: Table Driven Assembler (TASM) by Speech Technology Inc.


vid_mem          .equ 76d0h
vid_mem_end      .equ 0x7FF4
vid_mem_home     .equ 0x77C2
vid_mem_home_1   .equ 0x7810
vid_mem_width    .equ 0x004E
i8275_data       .equ 0xC000
i8275_ctrl       .equ 0xC001
cursor_home      .equ 0x0308

stack            .equ 76CFh

monitor_area     .equ 7600h
monitor_area_end .equ 765Fh

cursor_addr      .equ 7600h
cursor_xy        .equ 7602h
cursor_seq       .equ 7604h
ruslat_flag      .equ 7606h                  ; 0 - lat, ff - rus
stack_ptr        .equ 761Ch
memlim           .equ 7631h
kbd_buf          .equ 7633h

prompt_arg_1     .equ 7627h
prompt_arg_2     .equ 7629h
prompt_arg_3     .equ 762Bh
prompt_arg_a     .equ 762Dh


; segment 'seg000'
                .org 0F800h

;----------------------------------------------------------------------------

start:
                jmp     entry_start
;----------------------------------------------------------------------------

getc:
                jmp     entry_getc
;----------------------------------------------------------------------------

inpb:
                jmp     entry_inpb
;----------------------------------------------------------------------------

putc:
                jmp     entry_putc
;----------------------------------------------------------------------------

outb:
                jmp     entry_outb
;----------------------------------------------------------------------------

temp:
                jmp     entry_putc
;----------------------------------------------------------------------------

kbhit:
                jmp     entry_kbhit
;----------------------------------------------------------------------------

hexb:
                jmp     entry_hexb
;----------------------------------------------------------------------------

puts:
                jmp     entry_puts
;----------------------------------------------------------------------------

scan_kbd:
                jmp     entry_scan_kbd
;----------------------------------------------------------------------------

getxy:
                jmp     entry_getxy
;----------------------------------------------------------------------------

curc:
                jmp     entry_curc
;----------------------------------------------------------------------------

inpblock:
                jmp     entry_inpblock
;----------------------------------------------------------------------------

outblock:
                jmp     entry_outblock
;----------------------------------------------------------------------------

chksum:
                jmp     entry_chksum
;----------------------------------------------------------------------------

video:
                jmp     entry_video
;----------------------------------------------------------------------------

getlim:
                jmp     entry_getlim
;----------------------------------------------------------------------------

setlim:
                jmp     entry_setlim
;----------------------------------------------------------------------------

entry_start:
                mvi     a, 8Ah ; 'К'    ; CODE XREF: F800j
                sta     8003h

                lxi     sp, stack

                call    entry_video

                lxi     h, monitor_area
                lxi     d, monitor_area_end
                mvi     c, 0
                call    fill_hl_de_c    ; fill HL to DE by C

                lxi     h, stack
                shld    stack_ptr

                lxi     h, Radio
                call    entry_puts      ; put title

                call    entry_video

                lxi     h, 35FFh
                shld    memlim

                lxi     h, 1D2Ah
                shld    362Fh
                mvi     a, 0C3h
                sta     3626h

prompt_loop:
                lxi     sp, stack       ; CODE XREF: F90Bj FAB3j FFC9j FFD0j

                lxi     h, Prompt
                call    entry_puts

                sta     8002h
                dcr     a
                sta     0A002h

                call    prompt_console
                lxi     h, prompt_loop
                push    h
                lxi     h, kbd_buf
                mov     a, m
                cpi     58h ; 'X'
                jz      print_regs
                cpi     55h ; 'U'
                jz      0F000h          ; !?
                push    psw
                call    prompt_arguments
                lhld    prompt_arg_3
                mov     c, l
                mov     b, h
                lhld    prompt_arg_2
                xchg
                lhld    prompt_arg_1
                pop     psw
                cpi     44h ; 'D'
                jz      prompt_dump
                cpi     43h ; 'C'
                jz      prompt_compare
                cpi     46h ; 'F'
                jz      fill_hl_de_c
                cpi     53h ; 'S'
                jz      prompt_scan
                cpi     54h ; 'T'
                jz      prompt_translate
                cpi     4Dh ; 'M'
                jz      prompt_memory
                cpi     47h ; 'G'
                jz      prompt_go
                cpi     49h ; 'I'
                jz      prompt_input
                cpi     4Fh ; 'O'
                jz      prompt_output
                cpi     4Ch ; 'L'
                jz      prompt_list
                cpi     52h ; 'R'
                jz      prompt_read
                jmp     0F000h          ; ?!
;----------------------------------------------------------------------------

back_kbd_buf:
                mvi     a, 33h ; '3'    ; CODE XREF: F8F8j F8FDj
                cmp     l
                jz      kbd_buf_cont
                push    h
                lxi     h, BackClr
                call    entry_puts
                pop     h
                dcx     h
                jmp     kbd_buf_loop
;----------------------------------------------------------------------------

prompt_console:
                lxi     h, kbd_buf        ; CODE XREF: F87Cp FA2Dp FFE7p

kbd_buf_cont:
                mvi     b, 0            ; CODE XREF: F8DFj

kbd_buf_loop:
                call    entry_getc      ; CODE XREF: F8EBj F917j

                cpi     8               ; backspace ?
                jz      back_kbd_buf
                cpi     7Fh             ; backspace ?
                jz      back_kbd_buf

                cnz     prompt_puta
                mov     m, a
                cpi     0Dh
                jz      kbd_buf_ret
                cpi     2Eh ; '.'
                jz      prompt_loop
                mvi     b, 0FFh
                mvi     a, 52h ; 'R'
                cmp     l
                jz      prompt_error
                inx     h
                jmp     kbd_buf_loop
;----------------------------------------------------------------------------

kbd_buf_ret:
                mov     a, b            ; CODE XREF: F906j
                ral
                lxi     d, kbd_buf
                mvi     b, 0
                ret
;----------------------------------------------------------------------------

entry_puts:
                mov     a, m            ; CODE XREF: F818j F855p F872p F8E6p F929j F9B4p FFD6p
                ana     a
                rz
                call    prompt_puta
                inx     h
                jmp     entry_puts
;----------------------------------------------------------------------------

prompt_arguments:
                lxi     h, prompt_arg_1        ; CODE XREF: F892p
                lxi     d, prompt_arg_a
                mvi     c, 0
                call    fill_hl_de_c
                lxi     d, 3634h
                call    prompt_arg_read
                shld    prompt_arg_1
                shld    prompt_arg_2
                rc
                mvi     a, 0FFh
                sta     prompt_arg_a
                call    prompt_arg_read
                shld    prompt_arg_2
                rc
                call    prompt_arg_read
                shld    prompt_arg_3
                rc
                jmp     prompt_error
;----------------------------------------------------------------------------

prompt_arg_read:
                lxi     h, 0            ; CODE XREF: F93Ap F949p F950p FA35p FFEDp

prompt_arg_next:
                ldax    d               ; CODE XREF: F969j F98Bj
                inx     d
                cpi     0Dh
                jz      prompt_arg_ret
                cpi     2Ch ; ','
                rz
                cpi     20h ; ' '
                jz      prompt_arg_next
                sui     30h ; '0'
                jm      prompt_error
                cpi     0Ah
                jm      prompt_arg_cycle
                cpi     11h
                jm      prompt_error
                cpi     17h
                jp      prompt_error
                sui     7

prompt_arg_cycle:
                mov     c, a            ; CODE XREF: F973j
                dad     h
                dad     h
                dad     h
                dad     h
                jm      prompt_error
                dad     b
                jmp     prompt_arg_next
;----------------------------------------------------------------------------

prompt_arg_ret:
                stc                     ; CODE XREF: F961j
                ret
;----------------------------------------------------------------------------
; cmp hl, de
; if hl=de -> zf=1, else -> zf=0
;----------------------------------------------------------------------------
cmp_hl_de:
                mov     a, h            ; CODE XREF: F999p FA3Fp FAA6p FB1Dp FFC6p
                cmp     d
                rnz
                mov     a, l
                cmp     e
                ret
;----------------------------------------------------------------------------

cmp_hl_de_test:
                call    prompt_break      ; CODE XREF: F9CBp F9E7p F9F9p FA1Ap

cmp_hl_de_loop:
                call    cmp_hl_de      ; CODE XREF: F9EEp FA02p FA75p FB10p FB27p FB8Ap
                                        ; hl=de ?
                jnz     cmp_hl_de_next      ; if not, then hl=hl+1 and ret

cmp_hl_dl_break:                             ; hl=de, great!
                inx     sp              ; CODE XREF: FB20j
                inx     sp              ; pop ret-addr and exit
                ret

cmp_hl_de_next:
                inx     h               ; CODE XREF: F99Cj
                ret
;----------------------------------------------------------------------------
; Scan keyboard
;----------------------------------------------------------------------------
prompt_break:
                call    entry_scan_kbd      ; CODE XREF: F996p
                cpi     3
                rnz
                call    entry_video
                jmp     prompt_error
;----------------------------------------------------------------------------

loc_0_F9B0:
                push    h               ; CODE XREF: FB79p
                lxi     h, m_FF6C
                call    entry_puts
                pop     h
                ret
;----------------------------------------------------------------------------

prompt_hexmem:
                mov     a, m            ; CODE XREF: F9C8p F9DFp FA29p

prompt_hexa:
                push    b               ; CODE XREF: F9E3p FB81p
                call    entry_hexb
                mvi     a, 20h ; ' '
                call    prompt_puta
                pop     b
                ret
;----------------------------------------------------------------------------

prompt_dump:
                call    loc_0_FB78      ; CODE XREF: F8A4j F9D1j

prompt_dump_line:
                call    prompt_hexmem      ; CODE XREF: F9D4j
                call    cmp_hl_de_test
                mov     a, l
                ani     0Fh
                jz      prompt_dump
                jmp     prompt_dump_line
;----------------------------------------------------------------------------

prompt_compare:
                ldax    b               ; CODE XREF: F8A9j F9EAj
                cmp     m
                jz      prompt_compared
                call    loc_0_FB78
                call    prompt_hexmem
                ldax    b
                call    prompt_hexa

prompt_compared:
                inx     b               ; CODE XREF: F9D9j
                call    cmp_hl_de_test
                jmp     prompt_compare
;----------------------------------------------------------------------------

fill_hl_de_c:
                mov     m, c            ; CODE XREF: F849p F8AEj F934p F9F1j
                call    cmp_hl_de_loop
                jmp     fill_hl_de_c
;----------------------------------------------------------------------------

prompt_scan:
                mov     a, c            ; CODE XREF: F8B3j F9FCj
                cmp     m
                cz      loc_0_FB78
                call    cmp_hl_de_test
                jmp     prompt_scan
;----------------------------------------------------------------------------

prompt_translate:
                mov     a, m            ; CODE XREF: F8B8j FA05j
                stax    b
                inx     b
                call    cmp_hl_de_loop
                jmp     prompt_translate
;----------------------------------------------------------------------------

prompt_list:
                call    loc_0_FB78      ; CODE XREF: F8D1j FA20j

prompt_list_loop:
                mov     a, m            ; CODE XREF: FA23j
                ora     a
                jm      prompt_list_dot
                cpi     20h ; ' '
                jnc     prompt_list_next

prompt_list_dot:
                mvi     a, 2Eh ; '.'    ; CODE XREF: FA0Dj

prompt_list_next:
                call    prompt_puta      ; CODE XREF: FA12j
                call    cmp_hl_de_test
                mov     a, l
                ani     0Fh
                jz      prompt_list
                jmp     prompt_list_loop
;----------------------------------------------------------------------------

prompt_memory:
                call    loc_0_FB78      ; CODE XREF: F8BDj FA3Cj
                call    prompt_hexmem
                push    h
                call    prompt_console
                pop     h
                jnc     prompt_memory_next
                push    h
                call    prompt_arg_read
                mov     a, l
                pop     h
                mov     m, a

prompt_memory_next:
                inx     h               ; CODE XREF: FA31j
                jmp     prompt_memory
;----------------------------------------------------------------------------

prompt_go:
                call    cmp_hl_de      ; CODE XREF: F8C2j
                jz      prompt_go_to
                xchg
                shld    3623h
                mov     a, m
                sta     3625h
                mvi     m, 0F7h
                mvi     a, 0C3h
                sta     30h
                lxi     h, loc_0_FFA2h
                shld    31h

prompt_go_to:
                lxi     sp, 3618h       ; CODE XREF: FA42j
                pop     b
                pop     d
                pop     h
                pop     psw
                sphl
                lhld    3616h
                jmp     3626h
;----------------------------------------------------------------------------

prompt_read:
                mvi     a, 90h          ; CODE XREF: F8D6j
                sta     0A003h

prompt_read_loop:
                shld    0A001h          ; CODE XREF: FA78p
                lda     0A000h
                stax    b
                inx     b
                call    cmp_hl_de_loop
                call    loc_0_FA6D

entry_getxy:
                lhld    cursor_xy           ; CODE XREF: F81Ej
                ret
;----------------------------------------------------------------------------

entry_curc:
                push    h               ; CODE XREF: F821j
                lhld    cursor_addr
                mov     a, m
                pop     h
                ret
;----------------------------------------------------------------------------

prompt_input:
                lda     prompt_arg_a           ; CODE XREF: F8C7j
                ora     a
                jz      loc_0_FA91
                mov     a, e
                sta     362Fh

loc_0_FA91:
                call    entry_inpblock      ; CODE XREF: FA8Aj
                call    loc_0_FB78
                xchg
                call    loc_0_FB78
                xchg
                push    b
                call    entry_chksum
                mov     h, b
                mov     l, c
                call    loc_0_FB78
                pop     d
                call    cmp_hl_de
                rz
                xchg
                call    loc_0_FB78

prompt_error:
                mvi     a, 3Fh ; '?'    ; CODE XREF: F913j F957j F96Ej F978j F97Dj F987j F9ADj FC3Dj
                call    prompt_puta
                jmp     prompt_loop

;----------------------------------------------------------------------------
; Input from tape : In : HL - offset
;                   Out: HL - start, DE - end, BC - chksum
;----------------------------------------------------------------------------
entry_inpblock:                         ; CODE XREF: F824j FA91p
                mvi     a, 0FFh
                call    loc_0_FAFF      ; input word to BC with
                                        ; sinc-byte before 1-st byte
                                        ; it is addr from tape
                push    h
                dad     b               ; calc start addr:
                                        ; HL=tape addr + offset
                xchg                    ; DE=start addr
                call    loc_0_FAFD      ; input word to BC w/o sinc-byte
                                        ; it is end from tape
                pop     h               ; hl=offset
                dad     b               ; calc end addr:
                                        ; HL=tape addr + offset
                xchg                    ; hl=start addr, de=and addr
                push    h
                call    loc_0_FB0A      ; input block from hl -> de
                mvi     a, 0FFh         ; input word to bc
                call    loc_0_FAFF      ; with sinc-byte
                                        ; it is a chksum from tape
                pop     h               ; hl=addr

entry_video:                            ; -- start video
                push    h               ; CODE XREF: F82Dj F83Ep F858p F9AAp FB75j FC38p
                lxi     h, 0C001h
                mvi     m, 0
                dcx     h
                mvi     m, 4Dh
                mvi     m, 1Dh
                mvi     m, 99h
                mvi     m, 93h
                inx     h
                mvi     m, 27h
                mov     a, m

loc_0_FAE1:
                mov     a, m            ; CODE XREF: FAE4j
                ani     20h
                jz      loc_0_FAE1      ; wait for start video
                lxi     h, 0E008h
                mvi     m, 80h
                mvi     l, 4
                mvi     m, 0D0h
                mvi     m, 36h
                inr     l
                mvi     m, 23h
                mvi     m, 49h
                mvi     l, 8
                mvi     m, 0A4h
                pop     h
                ret

;----------------------------------------------------------------------------
; Input word to BC

loc_0_FAFD:                             ; -- w/o sinc-byte

                mvi     a, 8            ; CODE XREF: FABEp

loc_0_FAFF:

                call    entry_inpb      ; CODE XREF: FAB8p FACAp
                mov     b, a
                mvi     a, 8

loc_0_FB05:
                call    entry_inpb      ; CODE XREF: FB8Dj
                mov     c, a
                ret

;----------------------------------------------------------------------------
; Input block while de!=hl
loc_0_FB0A:                             ; CODE XREF: FAC5p FB13j
                mvi     a, 8
                call    entry_inpb      ; input byte to a w/o sinc-byte
                mov     m, a            ; to mem it
                call    cmp_hl_de_loop  ; check hl=de and
                                        ; if hl!=de -> hl=hl+1
                                        ; else -> ret to FAC0
                jmp     loc_0_FB0A      ; while hl!=de
;----------------------------------------------------------------------------
; Calc chksum
;----------------------------------------------------------------------------
entry_chksum:
                lxi     b, 0            ; CODE XREF: F82Aj FA9Dp FB36p

loc_0_FB19:
                mov     a, m            ; get byte
                add     c               ; lo part
                mov     c, a            ; store
                push    psw             ; save cf
                call    cmp_hl_de       ; hl=de
                jz      cmp_hl_dl_break      ; yes, remove psw and exit
                pop     psw             ; restore cf
                mov     a, b            ; hi part
                adc     m
                mov     b, a            ; store
                call    cmp_hl_de_loop  ; while hl!=de -> hl++
                                        ; otherwise -> exit over stack
                jmp     loc_0_FB19      ; repeat until de!=hl
;----------------------------------------------------------------------------
; monitor 'O' command
;
prompt_output:
                mov     a, c            ; CODE XREF: F8CCj
                ora     a
                jz      loc_0_FB35
                sta     3630h

loc_0_FB35:
                push    h               ; CODE XREF: FB2Fj
                call    entry_chksum
                pop     h
                call    loc_0_FB78
                xchg
                call    loc_0_FB78
                xchg
                push    h
                mov     h, b
                mov     l, c
                call    loc_0_FB78
                pop     h

                                        ; -- out block
entry_outblock:                         ; CODE XREF: F827j
                push    b               ; save chksum
                lxi     b, 0

loc_0_FB4D:                             ; make 256 zeros
                call    entry_outb      ; out 0 byte
                dcr     b
                xthl                    ; delay 18t
                xthl                    ; delay 18t
                jnz     loc_0_FB4D
                mvi     c, 0E6h
                call    entry_outb      ; out sinc-byte
                call    loc_0_FB90      ; out hl -- start addr
                xchg
                call    loc_0_FB90      ; out de -- end addr
                xchg
                call    loc_0_FB86      ; out block
                lxi     h, 0
                call    loc_0_FB90      ; out 0000
                mvi     c, 0E6h
                call    entry_outb      ; out sync-byte
                pop     h               ; restore chksum
                call    loc_0_FB90      ; out chksum
                jmp     entry_video
;----------------------------------------------------------------------------

loc_0_FB78:
                push    b               ; CODE XREF: F9C5p F9DCp F9F6p FA08p FA26p FA94p FA98p FAA2p FAABp FB3Ap FB3Ep FB45p
                                        ; FFBFp FFE4p
                call    loc_0_F9B0
                mov     a, h
                call    entry_hexb      ; out a in hex
                mov     a, l
                call    prompt_hexa
                pop     b
                ret
;----------------------------------------------------------------------------

loc_0_FB86:
                mov     c, m            ; get current byte
                call    entry_outb
                call    cmp_hl_de_loop  ; check hl=de and
                                        ; if hl!=de -> hl=hl+1
                                        ; else -> ret to FB66
                jmp     loc_0_FB86      ; out while hl!=de
;----------------------------------------------------------------------------
; Out hl to tape
loc_0_FB90:                             ; CODE XREF: FB5Bp FB5Fp FB69p FB72p
                mov     c, h
                call    entry_outb      ; out h
                mov     c, l
                jmp     entry_outb      ; out l and exit
;----------------------------------------------------------------------------
; Input byte
entry_inpb:
                push    h               ; CODE XREF: FAFFp FB05p FB0Cp
                push    b
                push    d
                mov     d, a            ; d = count, 'ff' for sinc-byte

loc_0_FB9C:

                mvi     a, 80h          ; CODE XREF: FC43j
                sta     0E008h          ; DMA ?!

                lxi     h, 0
                dad     sp              ; hl=sp
                lxi     sp, 0           ; sp=0
                shld    360Dh           ; save sp

                mvi     c, 0
                lda     8002h
                rrc
                rrc
                rrc
                rrc                     ; d0 -- get first state
                ani     1               ; mask other bits
                mov     e, a            ; e=d0

loc_0_FBB7:
                pop     psw             ; delay 11t
                mov     a, c            ; a = c (current byte)
                ani     7Fh             ; d7=0
                rlc                     ; clear d0 in c for next bit
                mov     c, a            ; c = a
                mvi     h, 0

loc_0_FBBF:
                dcr     h
                jz      loc_0_FC34      ; -- wait for change bit
                pop     psw             ; delay 11t
                lda     8002h
                rrc
                rrc
                rrc
                rrc                     ; d0 bit from tape
                ani     1               ; mask another bits
                cmp     e               ; d5 = prev d5 ?
                jz      loc_0_FBBF      ; wait while '='
                ora     c               ;
                mov     c, a            ; c0=bit, current bit
                dcr     d               ; count--
                lda     362Fh           ; a=input delay (2ah=42)
                jnz     loc_0_FBDC      ; if it is last bit ->
                sui     12h             ; dec delay

loc_0_FBDC:
                mov     b, a            ; b=input delay ( 5 )  -+ 1097
                                        ;                       |
loc_0_FBDD:                             ;                       |
                pop     psw             ; 11 -+                 |
                dcr     b               ; 5   | 26*42=1092     -+
                jnz     loc_0_FBDD      ; 10 -+
                inr     d               ; count++, restore
                lda     8002h
                rrc
                rrc
                rrc
                rrc                     ; d0=bit
                ani     1               ; mask other bits
                mov     e, a            ; e=d0
                mov     a, d            ; count=ff ?
                ora     a               ; we waits for sinc-byte ?
                jp      loc_0_FC0B      ; if not -> goto to count--
                mov     a, c            ; a=current byte state
                cpi     0E6h ;          ; a=sinc-byte ?
                jnz     loc_0_FBFF      ; if not -> goto
                xra     a
                sta     362Eh           ; [362E]=0
                jmp     loc_0_FC09
;----------------------------------------------------------------------------

loc_0_FBFF:
                cpi     19h             ; a=!sinc-byte ?
                jnz     loc_0_FBB7      ; if not -> goto
                mvi     a, 0FFh
                sta     362Eh           ; [362e]=FF

loc_0_FC09:                             ; sinc-byte or !sinc-byte inputed
                mvi     d, 9            ; start to input info byte

loc_0_FC0B:
                dcr     d               ; get another 9 sinc-bytes
                jnz     loc_0_FBB7

                lxi     h, 0E004h       ;   -+ DMA and VG ?!
                mvi     m, 0D0h         ;    |
                mvi     m, 36h          ;    |
                inx     h               ;    |
                mvi     m, 23h          ;    |
                mvi     m, 49h          ;    |
                mvi     a, 27h          ;    |
                sta     0C001h          ;    |
                mvi     a, 0E0h         ;    |
                sta     0C001h          ;    |
                mvi     l, 8            ;    |
                mvi     m, 0A4h         ;    |
                lhld    360Dh           ;    |
                sphl                    ;   -+

                lda     362Eh              ;
                xra     c
                jmp     loc_0_FCA1         ; exit
;----------------------------------------------------------------------------

loc_0_FC34:                             ; time-out !
                lhld    360Dh
                sphl                    ; restore stack
                call    entry_video
                mov     a, d
                ora     a               ; timeout in info-byte ?
                jp      prompt_error      ; yes -> warm restart monitor
                call    prompt_break      ; test for keypressing
                jmp     loc_0_FB9C      ; repeat input for sinc-byte
                                        ; again
;----------------------------------------------------------------------------
; Out byte from c
;
entry_outb:
                push    h               ; CODE XREF: F80Cj FB4Dp FB58p FB6Ep FB87p FB91p FB95j
                push    b
                push    d
                push    psw
                mvi     a, 80h
                sta     0E008h
                lxi     h, 0
                dad     sp
                lxi     sp, 0
                mvi     d, 8

loc_0_FC58:
                pop     psw             ; CODE XREF: FC82j
                mov     a, c
                rlc
                mov     c, a
                mvi     a, 1
                xra     c
                sta     8002h
                lda     3630h
                mov     b, a

loc_0_FC66:
                pop     psw             ; CODE XREF: FC68j
                dcr     b
                jnz     loc_0_FC66
                mvi     a, 0
                xra     c
                sta     8002h
                dcr     d
                lda     3630h
                jnz     loc_0_FC7A
                sui     0Eh

loc_0_FC7A:
                mov     b, a

loc_0_FC7B:
                pop     psw
                dcr     b
                jnz     loc_0_FC7B
                inr     d
                dcr     d
                jnz     loc_0_FC58
                sphl
                lxi     h, 0E004h
                mvi     m, 0D0h
                mvi     m, 36h
                inx     h
                mvi     m, 23h
                mvi     m, 49h
                mvi     a, 27h
                sta     0C001h
                mvi     a, 0E0h
                sta     0C001h
                mvi     l, 8
                mvi     m, 0A4h
                pop     psw

loc_0_FCA1:
                pop     d               ; CODE XREF: FC31j
                pop     b
                pop     h
                ret
;----------------------------------------------------------------------------

entry_hexb:
                push    psw             ; CODE XREF: F815j F9BBp FB7Dp
                rrc
                rrc
                rrc
                rrc
                call    hexb_tetr
                pop     psw

hexb_tetr:
                ani     0Fh             ; CODE XREF: FCAAp
                cpi     0Ah
                jm      hexb_make_sym
                adi     7

hexb_make_sym:
                adi     30h ; '0'       ; CODE XREF: FCB2j

prompt_puta:
                mov     c, a            ; CODE XREF: F900p F925p F9C0p FA17p FAB0p

entry_putc:
                push    psw             ; CODE XREF: F809j F80Fj
                push    b
                push    d
                push    h
                call    entry_kbhit     ; kbhit ?
                lxi     h, loc_0_FD85
                push    h
                lhld    cursor_xy
                xchg                    ; de=cursor pos
                lhld    cursor_addr     ; hl=cursor addr
                lda     cursor_seq
                dcr     a
                jm      loc_0_FCEE
                jz      loc_0_FD65
                jpo     loc_0_FD73
                mov     a, c
                sui     20h ; ' '
                mov     c, a

loc_0_FCDD:
                dcr     c               ; CODE XREF: FCE6j
                jm      loc_0_FCE9      ;
                push    b
                call    loc_0_FDB9
                pop     b
                jmp     loc_0_FCDD
;----------------------------------------------------------------------------

loc_0_FCE9:
                xra     a               ; CODE XREF: FCDEj FD68j

loc_0_FCEA:
                sta     cursor_seq      ; CODE XREF: FD70j FD7Aj FDA0j
                ret
;----------------------------------------------------------------------------

loc_0_FCEE:
                mov     a, c
                ani     7Fh
                mov     c, a
                cpi     1Fh
                jz      loc_0_FDA3
                cpi     0Ch
                jz      loc_0_FDB2
                cpi     0Dh

locret_0_FCFE:
                jz      loc_0_FDF3      ; CODE XREF: FCD0j
                cpi     0Ah

locret_0_FD03:
                jz      loc_0_FD47      ; CODE XREF: FD7Ep
                cpi     8
                jz      loc_0_FDD6
                cpi     18h
                jz      loc_0_FDB9
                cpi     19h
                jz      loc_0_FDE2
                cpi     1Ah
                jz      loc_0_FDC5
                cpi     1Bh
                jz      loc_0_FD9E
                cpi     7
                jnz     loc_0_FD38
                lxi     b, 5F0h

loc_0_FD27:
                mov     a, b            ; CODE XREF: FD34j FE3Ap

loc_0_FD28:
                ei                      ; CODE XREF: FD2Aj
                dcr     a
                jnz     loc_0_FD28
                mov     a, b

loc_0_FD2E:
                di                      ; CODE XREF: FD30j
                dcr     a
                jnz     loc_0_FD2E
                dcr     c
                jnz     loc_0_FD27
                ret
;----------------------------------------------------------------------------

loc_0_FD38:
                mov     m, c            ; CODE XREF: FD21j
                call    loc_0_FDB9
                mov     a, d
                cpi     3
                rnz
                mov     a, e
                cpi     8
                rnz
                call    loc_0_FDE2

loc_0_FD47:
                mov     a, d            ; CODE XREF: FD03j
                cpi     1Bh
                jnz     loc_0_FDC5
                push    h
                push    d
                lxi     h, vid_mem_home
                lxi     d, vid_mem_home_1
                lxi     b, 79Eh

loc_0_FD58:
                ldax    d               ; CODE XREF: FD5Fj
                mov     m, a
                inx     h
                inx     d
                dcx     b
                mov     a, c
                ora     b
                jnz     loc_0_FD58
                pop     d
                pop     h
                ret
;----------------------------------------------------------------------------

loc_0_FD65:
                mov     a, c            ; CODE XREF: FCD3j
                cpi     59h ; 'Y'
                jnz     loc_0_FCE9
                call    loc_0_FDB2
                mvi     a, 2
                jmp     loc_0_FCEA
;----------------------------------------------------------------------------

loc_0_FD73:
                mov     a, c            ; CODE XREF: FCD6j
                sui     20h ; ' '
                mov     c, a

loc_0_FD77:
                dcr     c               ; CODE XREF: FD82j
                mvi     a, 4
                jm      loc_0_FCEA
                push    b
                call    loc_0_FDC5
                pop     b
                jmp     loc_0_FD77
;----------------------------------------------------------------------------

loc_0_FD85:
                shld    cursor_addr
                xchg
                shld    cursor_xy
                mvi     a, 80h
                sta     i8275_ctrl
                mov     a, l
                sta     i8275_data
                mov     a, h

loc_0_FD96:
                sta     i8275_data      ; CODE XREF: F806j
                pop     h
                pop     d
                pop     b
                pop     psw
                ret
;----------------------------------------------------------------------------

loc_0_FD9E:
                mvi     a, 1            ; CODE XREF: FD1Cj
                jmp     loc_0_FCEA
;----------------------------------------------------------------------------

loc_0_FDA3:
                lxi     h, vid_mem_end  ; CODE XREF: FCF4j
                lxi     d, 925h

loc_0_FDA9:
                xra     a               ; CODE XREF: FDAFj
                mov     m, a
                dcx     h
                dcx     d
                mov     a, e
                ora     d
                jnz     loc_0_FDA9

loc_0_FDB2:
                lxi     d, cursor_home  ; CODE XREF: FCF9j FD6Bp
                lxi     h, vid_mem_home
                ret
;----------------------------------------------------------------------------

loc_0_FDB9:
                mov     a, e            ; CODE XREF: FCE2p FD0Dj FD39p
                inx     h
                inr     e
                cpi     47h ; 'G'
                rnz
                mvi     e, 8
                lxi     b, 0FFC0h
                dad     b

loc_0_FDC5:
                mov     a, d            ; CODE XREF: FD17j FD4Aj
                cpi     1Bh
                lxi     b, vid_mem_width; 'N'
                jnz     loc_0_FDD3
                mvi     d, 2
                lxi     b, 0F8B0h

loc_0_FDD3:
                inr     d               ; CODE XREF: FDCBj
                dad     b
                ret
;----------------------------------------------------------------------------

loc_0_FDD6:
                mov     a, e            ; CODE XREF: FD08j
                dcx     h
                dcr     e
                cpi     8
                rnz
                mvi     e, 47h ; 'G'
                lxi     b, 40h ; '@'
                dad     b

loc_0_FDE2:
                mov     a, d            ; CODE XREF: FD12j FD44p
                cpi     3
                lxi     b, 0FFB2h
                jnz     loc_0_FDF0
                mvi     d, 1Ch
                lxi     b, 750h

loc_0_FDF0:
                dcr     d               ; CODE XREF: FDE8j
                dad     b
                ret
;----------------------------------------------------------------------------

loc_0_FDF3:
                mov     a, l            ; CODE XREF: FCFEj
                sub     e
                jnc     loc_0_FDF9
                dcr     h

loc_0_FDF9:
                mov     l, a            ; CODE XREF: FDF5j
                mvi     e, 8
                lxi     b, 8
                dad     b
                ret
;----------------------------------------------------------------------------

entry_kbhit:				;
                lda     8002h           ; CODE XREF: F812j FCBEp FE63p
                ani     80h
                jz      loc_0_FE0E      ; Repeat now ?
                lda     3605h           ; Get last key
                ora     a               ; Check for 0 now
                rnz

loc_0_FE0E:
                push    h               ; CODE XREF: FE06j
                lhld    3609h
                call    entry_scan_kbd      ; Scan -- FF - not
                                                  FE - rus/lat
                                                  xx - key
                cmp     l
                mov     l, a
                jz      loc_0_FE2A

loc_0_FE1A:
                mvi     a, 1            ; CODE XREF: FE60j
                sta     360Bh
                mvi     h, 15h

loc_0_FE21:
                xra     a               ; CODE XREF: FE2Bj

loc_0_FE22:
                shld    3609h           ; CODE XREF: FE2Fj FE4Ej
                pop     h
                sta     3605h
                ret
;----------------------------------------------------------------------------

loc_0_FE2A:
                dcr     h               ; CODE XREF: FE17j
                jnz     loc_0_FE21
                inr     a
                jz      loc_0_FE22
                inr     a
                jz      loc_0_FE51
                push    b
                lxi     b, 5003h
                call    loc_0_FD27
                pop     b
                lda     360Bh
                mvi     h, 0E0h
                dcr     a
                sta     360Bh
                jz      loc_0_FE4C
                mvi     h, 40h ; '@'

loc_0_FE4C:
                mvi     a, 0FFh         ; CODE XREF: FE47j
                jmp     loc_0_FE22
;----------------------------------------------------------------------------

loc_0_FE51:
                lda     8002h           ; CODE XREF: FE33j FE56j
                ani     80h
                jz      loc_0_FE51
                lda     ruslat_flag
                cma
                sta     ruslat_flag
                jmp     loc_0_FE1A
;----------------------------------------------------------------------------

entry_getc:
                call    entry_kbhit      ; CODE XREF: F803j FE67j
                ora     a
                jz      entry_getc
                xra     a
                sta     3605h
                lda     3609h
                ret
;----------------------------------------------------------------------------

entry_scan_kbd:
                lda     8002h           ; CODE XREF: F81Bj F9A4p FE12p
                ani     80h             ; rus/lat ?
                jnz     loc_0_FE7D
                mvi     a, 0FEh         ; yes
                ret
;----------------------------------------------------------------------------

loc_0_FE7D:
                xra     a               ; CODE XREF: FE77j
                sta     8000h
                sta     8002h
                lda     ruslat_flag
                ani     1
                ori     6
                sta     8003h
                lda     8001h
                inr     a
                jnz     loc_0_FE97
                dcr     a
                ret
;----------------------------------------------------------------------------

loc_0_FE97:
                push    h               ; CODE XREF: FE92j
                mvi     l, 1            ; flying '1'
                mvi     h, 7            ; testing of 8 lines
                                        ; from 8 to 1

loc_0_FE9C:
                mov     a, l            ; CODE XREF: FEACj
                rrc
                mov     l, a
                cma
                sta     8000h
                lda     8001h
                cma
                ora     a
                jnz     loc_0_FEB3
                dcr     h
                jp      loc_0_FE9C

loc_0_FEAF:
                mvi     a, 0FEh         ; CODE XREF: FEBAj
                pop     h
                ret
;----------------------------------------------------------------------------

loc_0_FEB3:
                mvi     l, 20h ; ' '    ; CODE XREF: FEA8j

loc_0_FEB5:
                lda     8001h           ; CODE XREF: FEBEj
                cma
                ora     a
                jz      loc_0_FEAF
                dcr     l
                jnz     loc_0_FEB5
                mvi     l, 8

loc_0_FEC3:
                dcr     l               ; CODE XREF: FEC5j
                rlc
                jnc     loc_0_FEC3
                mov     a, h
                mov     h, l
                mov     l, a
                cpi     1
                jz      loc_0_FEFA
                jc      loc_0_FEF3
                rlc
                rlc
                rlc
                adi     20h ; ' '
                ora     h
                cpi     5Fh ; '_'
                jnz     loc_0_FF06
                mvi     a, 20h ; ' '
                pop     h
                ret
;----------------------------------------------------------------------------
unk_0_FEE2:     .db    9 ;
                .db 0Ah, 0Dh, 7Fh, 8, 19h, 18h, 1Ah
byte_0_FEEA:    .db 0Ch, 1Fh, 1Bh
                .db 0, 1, 2, 3, 4, 5
;----------------------------------------------------------------------------

loc_0_FEF3:
                mov     a, h            ; CODE XREF: FED0j
                lxi     h, byte_0_FEEA
                jmp     loc_0_FEFE
;----------------------------------------------------------------------------

loc_0_FEFA:
                mov     a, h            ; CODE XREF: FECDj
                lxi     h, unk_0_FEE2

loc_0_FEFE:
                add     l               ; CODE XREF: FEF7j
                mov     l, a
                mov     a, m
                cpi     40h ; '@'
                pop     h
                rc
                push    h

loc_0_FF06:
                mov     l, a            ; CODE XREF: FEDBj
                lda     8002h
                mov     h, a
                ani     40h
                jnz     loc_0_FF1A
                mov     a, l
                cpi     40h ; '@'
                jm      loc_0_FF3F
                ani     1Fh
                pop     h
                ret
;----------------------------------------------------------------------------

loc_0_FF1A:
                lda     ruslat_flag           ; CODE XREF: FF0Dj
                ora     a
                jz      loc_0_FF2A
                mov     a, l
                cpi     40h ; '@'
                jm      loc_0_FF2A
                ori     20h
                mov     l, a

loc_0_FF2A:
                mov     a, h            ; CODE XREF: FF1Ej FF24j
                ani     20h
                jnz     loc_0_FF3F
                mov     a, l
                cpi     40h ; '@'
                jm      loc_0_FF3B
                mov     a, l
                xri     20h
                pop     h
                ret
;----------------------------------------------------------------------------

loc_0_FF3B:
                mov     a, l            ; CODE XREF: FF33j
                ani     2Fh
                mov     l, a

loc_0_FF3F:
                mov     a, l            ; CODE XREF: FF13j FF2Dj
                cpi     40h ; '@'
                pop     h
                rp
                push    h
                mov     l, a
                ani     0Fh
                cpi     0Ch
                mov     a, l
                jm      loc_0_FF50
                cpi     10h

loc_0_FF50:
                pop     h               ; CODE XREF: FF4Bj
                ret
;----------------------------------------------------------------------------

entry_getlim:
                lhld    memlim           ; CODE XREF: F830j
                ret
;----------------------------------------------------------------------------

entry_setlim:
                shld    memlim           ; CODE XREF: F833j
                ret
;----------------------------------------------------------------------------
Radio:          .db  1Fh ;
m_Radio86rk:    .text "radio-86rk"      ; CODE XREF: F8F3p
	.db 0x72
	.db 0x61
	.db 0x64
	.db 0x69
	.db 0x6F
                .db 0
Prompt:         .dw 0A0Dh
m_FF68:         .text "-->"
                .db 0
m_FF6C:         .dw 0A0Dh
                .db 18h, 18h, 18h, 18h, 0   ; -> -> -> ->
Regs:           .dw 0A0Dh
m_Pc:           .text " PC-"
                .dw 0A0Dh
m_Hl:           .text " HL-"
                .dw 0A0Dh
m_Bc:           .text " BC-"
                .dw 0A0Dh
m_De:           .text " DE-"
                .dw 0D0Ah
m_Sp:           .text " SP-"
                .dw 0A0Dh
m_Af:           .text " AF-"
                .db 19h, 19h, 19h, 19h, 9, 19h, 19h
BackClr:        .db 8, 20h, 8, 0
;----------------------------------------------------------------------------

loc_0_FFA2:
                shld    3616h
                push    psw
                pop     h
                shld    361Eh
                pop     h
                dcx     h
                shld    3614h
                lxi     h, 0
                dad     sp
                lxi     sp, 361Eh
                push    h
                push    d
                push    b
                lhld    3614h
                lxi     sp, stack
                call    loc_0_FB78
                xchg
                lhld    3623h
                call    cmp_hl_de
                jnz     prompt_loop
                lda     3625h
                mov     m, a
                jmp     prompt_loop
;----------------------------------------------------------------------------

print_regs:
                lxi     h, Regs         ; CODE XREF: F889j
                call    entry_puts
                lxi     h, 3614h
                mvi     b, 6

loc_0_FFDE:
                mov     e, m            ; CODE XREF: FFFAj
                inx     h
                mov     d, m
                push    b
                push    h
                xchg
                call    loc_0_FB78
                call    prompt_console
                jnc     loc_0_FFF6
                call    prompt_arg_read
                pop     d
                push    d
                xchg
                mov     m, d
                dcx     h
                mov     m, e

loc_0_FFF6:
                pop     h               ; CODE XREF: FFEAj
                pop     b
                dcr     b
                inx     h
                jnz     loc_0_FFDE
                ret
;----------------------------------------------------------------------------
                .dw 89BBh               ; junk

; end of 'seg000'


                .end</textarea>
<!--
pc:0xF800	IP	`r.pc.x.toHex(4)`[`m.slice(r.pc.x, r.pc.x+16).toHex(8,"|")`]PC(Program Counter)
sp:0x0000	SP	`r.sp.x.toHex(4)`[`m.slice(r.sp.x-8,r.sp.x+8).toHex(8,"|")`]SP(Stack Pointer)
bc:0xFFF8	BC	`r.bc.x.toHex(4)`[`m.slice(r.bc.x, r.bc.x+16).toHex()`]BC(All Purposes Counters)
de:0x4458	DE	`r.de.x.toHex(4)`[`m.slice(r.de.x, r.de.x+16).toHex()`]DE(All Purposes Enhancer)
hl:0x4258	HL	`r.hl.x.toHex(4)`[`m.slice(r.hl.x-8,r.hl.x+8).toHex(8,"|")`]HL(All Purposes Pointer)
xp:0x0000	XP	`r.sp.x.toHex(4)`[`m.toHex(r.sp.x,"-- -- -- -- -- -- -- --|-- -- -- -- -- -- -- --]................")`|XP(Stack Pointer)
zp:0x0000	ZP	`m.toDump("@@@@[-- -- -- -- -- -- -- --|<u>++ ++ ++ ++ ++ ++ ++ ++</u>]................",r.pc.x)`|XP(Stack Pointer)
-->
<textarea id=Dump rows=50 cols=160 style=display:none>
F800 C3 36 F8 C3 63 FE C3 98 FB C3 BA FC C3 46 FC C3 BA FC C3 01 FE C3 A5 FC C3 22 F9 C3 72 FE C3 7B FA C3 7F FA C3 B6 FA C3 49 FB C3 16 FB C3 CE FA C3 52 FF C3 56 FF 3E 8A 32 03 80 31 CF 76 CD CE
F840 FA 21 00 76 11 5F 76 0E 00 CD ED F9 21 CF 76 22 1C 76 21 5A FF CD 22 F9 CD CE FA 21 FF 75 22 31 76 21 2A 1D 22 2F 76 3E C3 32 26 76 31 CF 76 21 66 FF CD 22 F9 32 02 80 3D 32 02 A0 CD EE F8 21
F880 6C F8 E5 21 33 76 7E FE 58 CA D3 FF FE 55 CA 00 F0 F5 CD 2C F9 2A 2B 76 4D 44 2A 29 76 EB 2A 27 76 F1 FE 44 CA C5 F9 FE 43 CA D7 F9 FE 46 CA ED F9 FE 53 CA F4 F9 FE 54 CA FF F9 FE 4D CA 26 FA
F8C0 FE 47 CA 3F FA FE 49 CA 86 FA FE 4F CA 2D FB FE 4C CA 08 FA FE 52 CA 68 FA C3 00 F0 3E 33 BD CA F1 F8 E5 21 9E FF CD 22 F9 E1 2B C3 F3 F8 21 33 76 06 00 CD 63 FE FE 08 CA DC F8 FE 7F CA DC F8
F900 C4 B9 FC 77 FE 0D CA 1A F9 FE 2E CA 6C F8 06 FF 3E 52 BD CA AE FA 23 C3 F3 F8 78 17 11 33 76 06 00 C9 7E A7 C8 CD B9 FC 23 C3 22 F9 21 27 76 11 2D 76 0E 00 CD ED F9 11 34 76 CD 5A F9 22 27 76
F940 22 29 76 D8 3E FF 32 2D 76 CD 5A F9 22 29 76 D8 CD 5A F9 22 2B 76 D8 C3 AE FA 21 00 00 1A 13 FE 0D CA 8E F9 FE 2C C8 FE 20 CA 5D F9 D6 30 FA AE FA FE 0A FA 82 F9 FE 11 FA AE FA FE 17 F2 AE FA
F980 D6 07 4F 29 29 29 29 DA AE FA 09 C3 5D F9 37 C9 7C BA C0 7D BB C9 CD A4 F9 CD 90 F9 C2 A2 F9 33 33 C9 23 C9 CD 72 FE FE 03 C0 CD CE FA C3 AE FA E5 21 6C FF CD 22 F9 E1 C9 7E C5 CD A5 FC 3E 20
F9C0 CD B9 FC C1 C9 CD 78 FB CD B9 F9 CD 96 F9 7D E6 0F CA C5 F9 C3 C8 F9 0A BE CA E6 F9 CD 78 FB CD B9 F9 0A CD BA F9 03 CD 96 F9 C3 D7 F9 71 CD 99 F9 C3 ED F9 79 BE CC 78 FB CD 96 F9 C3 F4 F9 7E
FA00 02 03 CD 99 F9 C3 FF F9 CD 78 FB 7E B7 FA 15 FA FE 20 D2 17 FA 3E 2E CD B9 FC CD 96 F9 7D E6 0F CA 08 FA C3 0B FA CD 78 FB CD B9 F9 E5 CD EE F8 E1 D2 3B FA E5 CD 5A F9 7D E1 77 23 C3 26 FA CD
FA40 90 F9 CA 5A FA EB 22 23 76 7E 32 25 76 36 F7 3E C3 32 30 00 21 A2 FF 22 31 00 31 18 76 C1 D1 E1 F1 F9 2A 16 76 C3 26 76 3E 90 32 03 A0 22 01 A0 3A 00 A0 02 03 CD 99 F9 C3 6D FA 2A 02 76 C9 E5
FA80 2A 00 76 7E E1 C9 3A 2D 76 B7 CA 91 FA 7B 32 2F 76 CD B6 FA CD 78 FB EB CD 78 FB EB C5 CD 16 FB 60 69 CD 78 FB D1 CD 90 F9 C8 EB CD 78 FB 3E 3F CD B9 FC C3 6C F8 3E FF CD FF FA E5 09 EB CD FD
FAC0 FA E1 09 EB E5 CD 0A FB 3E FF CD FF FA E1 E5 21 01 C0 36 00 2B 36 4D 36 1D 36 99 36 93 23 36 27 7E 7E E6 20 CA E1 FA 21 08 E0 36 80 2E 04 36 D0 36 76 2C 36 23 36 49 2E 08 36 A4 E1 C9 3E 08 CD
FB00 98 FB 47 3E 08 CD 98 FB 4F C9 3E 08 CD 98 FB 77 CD 99 F9 C3 0A FB 01 00 00 7E 81 4F F5 CD 90 F9 CA 9F F9 F1 78 8E 47 CD 99 F9 C3 19 FB 79 B7 CA 35 FB 32 30 76 E5 CD 16 FB E1 CD 78 FB EB CD 78
FB40 FB EB E5 60 69 CD 78 FB E1 C5 01 00 00 CD 46 FC 05 E3 E3 C2 4D FB 0E E6 CD 46 FC CD 90 FB EB CD 90 FB EB CD 86 FB 21 00 00 CD 90 FB 0E E6 CD 46 FC E1 CD 90 FB C3 CE FA C5 CD B0 F9 7C CD A5 FC
FB80 7D CD BA F9 C1 C9 4E CD 46 FC CD 99 F9 C3 86 FB 4C CD 46 FC 4D C3 46 FC E5 C5 D5 57 3E 80 32 08 E0 21 00 00 39 31 00 00 22 0D 76 0E 00 3A 02 80 0F 0F 0F 0F E6 01 5F F1 79 E6 7F 07 4F 26 00 25
FBC0 CA 34 FC F1 3A 02 80 0F 0F 0F 0F E6 01 BB CA BF FB B1 4F 15 3A 2F 76 C2 DC FB D6 12 47 F1 05 C2 DD FB 14 3A 02 80 0F 0F 0F 0F E6 01 5F 7A B7 F2 0B FC 79 FE E6 C2 FF FB AF 32 2E 76 C3 09 FC FE
FC00 19 C2 B7 FB 3E FF 32 2E 76 16 09 15 C2 B7 FB 21 04 E0 36 D0 36 76 23 36 23 36 49 3E 27 32 01 C0 3E E0 32 01 C0 2E 08 36 A4 2A 0D 76 F9 3A 2E 76 A9 C3 A1 FC 2A 0D 76 F9 CD CE FA 7A B7 F2 AE FA
FC40 CD A4 F9 C3 9C FB E5 C5 D5 F5 3E 80 32 08 E0 21 00 00 39 31 00 00 16 08 F1 79 07 4F 3E 01 A9 32 02 80 3A 30 76 47 F1 05 C2 66 FC 3E 00 A9 32 02 80 15 3A 30 76 C2 7A FC D6 0E 47 F1 05 C2 7B FC
FC80 14 15 C2 58 FC F9 21 04 E0 36 D0 36 76 23 36 23 36 49 3E 27 32 01 C0 3E E0 32 01 C0 2E 08 36 A4 F1 D1 C1 E1 C9 F5 0F 0F 0F 0F CD AE FC F1 E6 0F FE 0A FA B7 FC C6 07 C6 30 4F F5 C5 D5 E5 CD 01
FCC0 FE 21 85 FD E5 2A 02 76 EB 2A 00 76 3A 04 76 3D FA EE FC CA 65 FD E2 73 FD 79 D6 20 4F 0D FA E9 FC C5 CD B9 FD C1 C3 DD FC AF 32 04 76 C9 79 E6 7F 4F FE 1F CA A3 FD FE 0C CA B2 FD FE 0D CA F3
FD00 FD FE 0A CA 47 FD FE 08 CA D6 FD FE 18 CA B9 FD FE 19 CA E2 FD FE 1A CA C5 FD FE 1B CA 9E FD FE 07 C2 38 FD 01 F0 05 78 FB 3D C2 28 FD 78 F3 3D C2 2E FD 0D C2 27 FD C9 71 CD B9 FD 7A FE 03 C0
FD40 7B FE 08 C0 CD E2 FD 7A FE 1B C2 C5 FD E5 D5 21 C2 77 11 10 78 01 9E 07 1A 77 23 13 0B 79 B0 C2 58 FD D1 E1 C9 79 FE 59 C2 E9 FC CD B2 FD 3E 02 C3 EA FC 79 D6 20 4F 0D 3E 04 FA EA FC C5 CD C5
FD80 FD C1 C3 77 FD 22 00 76 EB 22 02 76 3E 80 32 01 C0 7D 32 00 C0 7C 32 00 C0 E1 D1 C1 F1 C9 3E 01 C3 EA FC 21 F4 7F 11 25 09 AF 77 2B 1B 7B B2 C2 A9 FD 11 08 03 21 C2 77 C9 7B 23 1C FE 47 C0 1E
FDC0 08 01 C0 FF 09 7A FE 1B 01 4E 00 C2 D3 FD 16 02 01 B0 F8 14 09 C9 7B 2B 1D FE 08 C0 1E 47 01 40 00 09 7A FE 03 01 B2 FF C2 F0 FD 16 1C 01 50 07 15 09 C9 7D 93 D2 F9 FD 25 6F 1E 08 01 08 00 09
FE00 C9 3A 02 80 E6 80 CA 0E FE 3A 05 76 B7 C0 E5 2A 09 76 CD 72 FE BD 6F CA 2A FE 3E 01 32 0B 76 26 15 AF 22 09 76 E1 32 05 76 C9 25 C2 21 FE 3C CA 22 FE 3C CA 51 FE C5 01 03 50 CD 27 FD C1 3A 0B
FE40 76 26 E0 3D 32 0B 76 CA 4C FE 26 40 3E FF C3 22 FE 3A 02 80 E6 80 CA 51 FE 3A 06 76 2F 32 06 76 C3 1A FE CD 01 FE B7 CA 63 FE AF 32 05 76 3A 09 76 C9 3A 02 80 E6 80 C2 7D FE 3E FE C9 AF 32 00
FE80 80 32 02 80 3A 06 76 E6 01 F6 06 32 03 80 3A 01 80 3C C2 97 FE 3D C9 E5 2E 01 26 07 7D 0F 6F 2F 32 00 80 3A 01 80 2F B7 C2 B3 FE 25 F2 9C FE 3E FF E1 C9 2E 20 3A 01 80 2F B7 CA AF FE 2D C2 B5
FEC0 FE 2E 08 2D 07 D2 C3 FE 7C 65 6F FE 01 CA FA FE DA F3 FE 07 07 07 C6 20 B4 FE 5F C2 06 FF 3E 20 E1 C9 09 0A 0D 7F 08 19 18 1A 0C 1F 1B 00 01 02 03 04 05 7C 21 EA FE C3 FE FE 7C 21 E2 FE 85 6F
FF00 7E FE 40 E1 D8 E5 6F 3A 02 80 67 E6 40 C2 1A FF 7D FE 40 FA 3F FF E6 1F E1 C9 3A 06 76 B7 CA 2A FF 7D FE 40 FA 2A FF F6 20 6F 7C E6 20 C2 3F FF 7D FE 40 FA 3B FF 7D EE 20 E1 C9 7D E6 2F 6F 7D
FF40 FE 40 E1 F0 E5 6F E6 0F FE 0C 7D FA 50 FF EE 10 E1 C9 2A 31 76 C9 22 31 76 C9 1F 72 61 64 69 6F 2D 38 36 72 6B 00 0D 0A 2D 2D 3E 00 0D 0A 18 18 18 18 00 0D 0A 20 50 43 2D 0D 0A 20 48 4C 2D 0D
FF80 0A 20 42 43 2D 0D 0A 20 44 45 2D 0D 0A 20 53 50 2D 0D 0A 20 41 46 2D 19 19 19 19 19 19 00 08 20 08 00 22 16 76 F5 E1 22 1E 76 E1 2B 22 14 76 21 00 00 39 31 1E 76 E5 D5 C5 2A 14 76 31 CF 76 CD
FFC0 78 FB EB 2A 23 76 CD 90 F9 C2 6C F8 3A 25 76 77 C3 6C F8 21 73 FF CD 22 F9 21 14 76 06 06 5E 23 56 C5 E5 EB CD 78 FB CD EE F8 D2 F6 FF CD 5A F9 D1 D5 EB 72 2B 73 E1 C1 05 23 C2 DE FF C9 FF FF

F800 C3 36 F8 C3 63 FE C3 98 FB C3 BA FC C3 46 FC C3 BA FC C3 01 FE C3 A5 FC C3 22 F9 C3 72 FE C3 7B FA C3 7F FA C3 B6 FA C3 49 FB C3 16 FB C3 CE FA
F830 C3 52 FF C3 56 FF 3E 8A 32 03 80 31 CF 76 CD CE FA 21 00 76 11 5F 76 0E 00 CD ED F9 21 CF 76 22 1C 76 21 5A FF CD 22 F9 CD CE FA 21 FF 75 22 31
F860 76 21 2A 1D 22 2F 76 3E C3 32 26 76 31 CF 76 21 66 FF CD 22 F9 32 02 80 3D 32 02 A0 CD EE F8 21 6C F8 E5 21 33 76 7E FE 58 CA D3 FF FE 55 CA 00
F890 F0 F5 CD 2C F9 2A 2B 76 4D 44 2A 29 76 EB 2A 27 76 F1 FE 44 CA C5 F9 FE 43 CA D7 F9 FE 46 CA ED F9 FE 53 CA F4 F9 FE 54 CA FF F9 FE 4D CA 26 FA
F8C0 FE 47 CA 3F FA FE 49 CA 86 FA FE 4F CA 2D FB FE 4C CA 08 FA FE 52 CA 68 FA C3 00 F0 3E 33 BD CA F1 F8 E5 21 9E FF CD 22 F9 E1 2B C3 F3 F8 21 33
F8F0 76 06 00 CD 63 FE FE 08 CA DC F8 FE 7F CA DC F8 C4 B9 FC 77 FE 0D CA 1A F9 FE 2E CA 6C F8 06 FF 3E 52 BD CA AE FA 23 C3 F3 F8 78 17 11 33 76 06
F920 00 C9 7E A7 C8 CD B9 FC 23 C3 22 F9 21 27 76 11 2D 76 0E 00 CD ED F9 11 34 76 CD 5A F9 22 27 76 22 29 76 D8 3E FF 32 2D 76 CD 5A F9 22 29 76 D8
F950 CD 5A F9 22 2B 76 D8 C3 AE FA 21 00 00 1A 13 FE 0D CA 8E F9 FE 2C C8 FE 20 CA 5D F9 D6 30 FA AE FA FE 0A FA 82 F9 FE 11 FA AE FA FE 17 F2 AE FA
F980 D6 07 4F 29 29 29 29 DA AE FA 09 C3 5D F9 37 C9 7C BA C0 7D BB C9 CD A4 F9 CD 90 F9 C2 A2 F9 33 33 C9 23 C9 CD 72 FE FE 03 C0 CD CE FA C3 AE FA
F9B0 E5 21 6C FF CD 22 F9 E1 C9 7E C5 CD A5 FC 3E 20 CD B9 FC C1 C9 CD 78 FB CD B9 F9 CD 96 F9 7D E6 0F CA C5 F9 C3 C8 F9 0A BE CA E6 F9 CD 78 FB CD
F9E0 B9 F9 0A CD BA F9 03 CD 96 F9 C3 D7 F9 71 CD 99 F9 C3 ED F9 79 BE CC 78 FB CD 96 F9 C3 F4 F9 7E 02 03 CD 99 F9 C3 FF F9 CD 78 FB 7E B7 FA 15 FA
FA10 FE 20 D2 17 FA 3E 2E CD B9 FC CD 96 F9 7D E6 0F CA 08 FA C3 0B FA CD 78 FB CD B9 F9 E5 CD EE F8 E1 D2 3B FA E5 CD 5A F9 7D E1 77 23 C3 26 FA CD
FA40 90 F9 CA 5A FA EB 22 23 76 7E 32 25 76 36 F7 3E C3 32 30 00 21 A2 FF 22 31 00 31 18 76 C1 D1 E1 F1 F9 2A 16 76 C3 26 76 3E 90 32 03 A0 22 01 A0
FA70 3A 00 A0 02 03 CD 99 F9 C3 6D FA 2A 02 76 C9 E5 2A 00 76 7E E1 C9 3A 2D 76 B7 CA 91 FA 7B 32 2F 76 CD B6 FA CD 78 FB EB CD 78 FB EB C5 CD 16 FB
FAA0 60 69 CD 78 FB D1 CD 90 F9 C8 EB CD 78 FB 3E 3F CD B9 FC C3 6C F8 3E FF CD FF FA E5 09 EB CD FD FA E1 09 EB E5 CD 0A FB 3E FF CD FF FA E1 E5 21
FAD0 01 C0 36 00 2B 36 4D 36 1D 36 99 36 93 23 36 27 7E 7E E6 20 CA E1 FA 21 08 E0 36 80 2E 04 36 D0 36 76 2C 36 23 36 49 2E 08 36 A4 E1 C9 3E 08 CD
FB00 98 FB 47 3E 08 CD 98 FB 4F C9 3E 08 CD 98 FB 77 CD 99 F9 C3 0A FB 01 00 00 7E 81 4F F5 CD 90 F9 CA 9F F9 F1 78 8E 47 CD 99 F9 C3 19 FB 79 B7 CA
FB30 35 FB 32 30 76 E5 CD 16 FB E1 CD 78 FB EB CD 78 FB EB E5 60 69 CD 78 FB E1 C5 01 00 00 CD 46 FC 05 E3 E3 C2 4D FB 0E E6 CD 46 FC CD 90 FB EB CD
FB60 90 FB EB CD 86 FB 21 00 00 CD 90 FB 0E E6 CD 46 FC E1 CD 90 FB C3 CE FA C5 CD B0 F9 7C CD A5 FC 7D CD BA F9 C1 C9 4E CD 46 FC CD 99 F9 C3 86 FB
FB90 4C CD 46 FC 4D C3 46 FC E5 C5 D5 57 3E 80 32 08 E0 21 00 00 39 31 00 00 22 0D 76 0E 00 3A 02 80 0F 0F 0F 0F E6 01 5F F1 79 E6 7F 07 4F 26 00 25
FBC0 CA 34 FC F1 3A 02 80 0F 0F 0F 0F E6 01 BB CA BF FB B1 4F 15 3A 2F 76 C2 DC FB D6 12 47 F1 05 C2 DD FB 14 3A 02 80 0F 0F 0F 0F E6 01 5F 7A B7 F2
FBF0 0B FC 79 FE E6 C2 FF FB AF 32 2E 76 C3 09 FC FE 19 C2 B7 FB 3E FF 32 2E 76 16 09 15 C2 B7 FB 21 04 E0 36 D0 36 76 23 36 23 36 49 3E 27 32 01 C0
FC20 3E E0 32 01 C0 2E 08 36 A4 2A 0D 76 F9 3A 2E 76 A9 C3 A1 FC 2A 0D 76 F9 CD CE FA 7A B7 F2 AE FA CD A4 F9 C3 9C FB E5 C5 D5 F5 3E 80 32 08 E0 21
FC50 00 00 39 31 00 00 16 08 F1 79 07 4F 3E 01 A9 32 02 80 3A 30 76 47 F1 05 C2 66 FC 3E 00 A9 32 02 80 15 3A 30 76 C2 7A FC D6 0E 47 F1 05 C2 7B FC
FC80 14 15 C2 58 FC F9 21 04 E0 36 D0 36 76 23 36 23 36 49 3E 27 32 01 C0 3E E0 32 01 C0 2E 08 36 A4 F1 D1 C1 E1 C9 F5 0F 0F 0F 0F CD AE FC F1 E6 0F
FCB0 FE 0A FA B7 FC C6 07 C6 30 4F F5 C5 D5 E5 CD 01 FE 21 85 FD E5 2A 02 76 EB 2A 00 76 3A 04 76 3D FA EE FC CA 65 FD E2 73 FD 79 D6 20 4F 0D FA E9
FCE0 FC C5 CD B9 FD C1 C3 DD FC AF 32 04 76 C9 79 E6 7F 4F FE 1F CA A3 FD FE 0C CA B2 FD FE 0D CA F3 FD FE 0A CA 47 FD FE 08 CA D6 FD FE 18 CA B9 FD
FD10 FE 19 CA E2 FD FE 1A CA C5 FD FE 1B CA 9E FD FE 07 C2 38 FD 01 F0 05 78 FB 3D C2 28 FD 78 F3 3D C2 2E FD 0D C2 27 FD C9 71 CD B9 FD 7A FE 03 C0
FD40 7B FE 08 C0 CD E2 FD 7A FE 1B C2 C5 FD E5 D5 21 C2 77 11 10 78 01 9E 07 1A 77 23 13 0B 79 B0 C2 58 FD D1 E1 C9 79 FE 59 C2 E9 FC CD B2 FD 3E 02
FD70 C3 EA FC 79 D6 20 4F 0D 3E 04 FA EA FC C5 CD C5 FD C1 C3 77 FD 22 00 76 EB 22 02 76 3E 80 32 01 C0 7D 32 00 C0 7C 32 00 C0 E1 D1 C1 F1 C9 3E 01
FDA0 C3 EA FC 21 F4 7F 11 25 09 AF 77 2B 1B 7B B2 C2 A9 FD 11 08 03 21 C2 77 C9 7B 23 1C FE 47 C0 1E 08 01 C0 FF 09 7A FE 1B 01 4E 00 C2 D3 FD 16 02
FDD0 01 B0 F8 14 09 C9 7B 2B 1D FE 08 C0 1E 47 01 40 00 09 7A FE 03 01 B2 FF C2 F0 FD 16 1C 01 50 07 15 09 C9 7D 93 D2 F9 FD 25 6F 1E 08 01 08 00 09
FE00 C9 3A 02 80 E6 80 CA 0E FE 3A 05 76 B7 C0 E5 2A 09 76 CD 72 FE BD 6F CA 2A FE 3E 01 32 0B 76 26 15 AF 22 09 76 E1 32 05 76 C9 25 C2 21 FE 3C CA
FE30 22 FE 3C CA 51 FE C5 01 03 50 CD 27 FD C1 3A 0B 76 26 E0 3D 32 0B 76 CA 4C FE 26 40 3E FF C3 22 FE 3A 02 80 E6 80 CA 51 FE 3A 06 76 2F 32 06 76
FE60 C3 1A FE CD 01 FE B7 CA 63 FE AF 32 05 76 3A 09 76 C9 3A 02 80 E6 80 C2 7D FE 3E FE C9 AF 32 00 80 32 02 80 3A 06 76 E6 01 F6 06 32 03 80 3A 01
FE90 80 3C C2 97 FE 3D C9 E5 2E 01 26 07 7D 0F 6F 2F 32 00 80 3A 01 80 2F B7 C2 B3 FE 25 F2 9C FE 3E FF E1 C9 2E 20 3A 01 80 2F B7 CA AF FE 2D C2 B5
FEC0 FE 2E 08 2D 07 D2 C3 FE 7C 65 6F FE 01 CA FA FE DA F3 FE 07 07 07 C6 20 B4 FE 5F C2 06 FF 3E 20 E1 C9 09 0A 0D 7F 08 19 18 1A 0C 1F 1B 00 01 02
FEF0 03 04 05 7C 21 EA FE C3 FE FE 7C 21 E2 FE 85 6F 7E FE 40 E1 D8 E5 6F 3A 02 80 67 E6 40 C2 1A FF 7D FE 40 FA 3F FF E6 1F E1 C9 3A 06 76 B7 CA 2A
FF20 FF 7D FE 40 FA 2A FF F6 20 6F 7C E6 20 C2 3F FF 7D FE 40 FA 3B FF 7D EE 20 E1 C9 7D E6 2F 6F 7D FE 40 E1 F0 E5 6F E6 0F FE 0C 7D FA 50 FF EE 10
FF50 E1 C9 2A 31 76 C9 22 31 76 C9 1F 72 61 64 69 6F 2D 38 36 72 6B 00 0D 0A 2D 2D 3E 00 0D 0A 18 18 18 18 00 0D 0A 20 50 43 2D 0D 0A 20 48 4C 2D 0D
FF80 0A 20 42 43 2D 0D 0A 20 44 45 2D 0D 0A 20 53 50 2D 0D 0A 20 41 46 2D 19 19 19 19 19 19 00 08 20 08 00 22 16 76 F5 E1 22 1E 76 E1 2B 22 14 76 21
FFB0 00 00 39 31 1E 76 E5 D5 C5 2A 14 76 31 CF 76 CD 78 FB EB 2A 23 76 CD 90 F9 C2 6C F8 3A 25 76 77 C3 6C F8 21 73 FF CD 22 F9 21 14 76 06 06 5E 23
FFE0 56 C5 E5 EB CD 78 FB CD EE F8 D2 F6 FF CD 5A F9 D1 D5 EB 72 2B 73 E1 C1 05 23 C2 DE FF C9 FF FF
</textarea>
<textarea id=Pattern rows=32 cols=128 style=position:absolute>
-------		stylex-field	-------		Here are declared all styles of disassembling code	-------
.style				CPU_GROUP_?								Unactive instruction presentable style
.active				CPU_GROUP_?_ active							Active instruction
.breaker			CPU_GROUP_? halted							Breaked instruction
.crack				CPU_GROUP_?_ halted							Breaked active instruction
.debug				CPU_GROUP_? user							Debug view selected instruction
.enable				CPU_GROUP_?_ user active						Debug view active instruction
.fixed				CPU_GROUP_? user halted							Debug view breaked instruction
.gap				CPU_GROUP_?_ user halted						Debug view breaked active instruction
-------		regex-field	-------		Here are declared all registers and its dumping		-------
pc:0xF800	IP	`m.toDump("@@@@[<span class=CPU_DUMP_B>-- -- -- -- -- -- -- --</span>|++ ++ ++ ++ ++ ++ ++ ++]................",r.pc.x)`|IP
sp:0x0000	SP	`m.toDump("@@@@[<span class=CPU_DUMP_B>-- -- -- -- -- -- -- --</span>|++ ++ ++ ++ ++ ++ ++ ++]................",r.sp.x)`|SP
bc:0xFFF8	CX	`m.toDump("@@@@[<span class=CPU_DUMP_B>-- -- -- -- -- -- -- --</span>|++ ++ ++ ++ ++ ++ ++ ++]................",r.bc.x)`|CX
de:0x4458	DX	`m.toDump("@@@@[<span class=CPU_DUMP_B>-- -- -- -- -- -- -- --</span>|++ ++ ++ ++ ++ ++ ++ ++]................",r.de.x)`|DX
hl:0x4258	BX	`m.toDump("@@@@[<span class=CPU_DUMP_B>-- -- -- -- -- -- -- --</span>|++ ++ ++ ++ ++ ++ ++ ++]................",r.hl.x)`|BX
psw:0x4100	AF	`r.psw.x.toHex(4)`[`$0=r.psw.l,"sf zf ?0 af ?0 pf ?0 cf".replace(/(\S+)/g, function(s, b) { return 256&($0*=2)?b.toUpperCase().replace("0","1"):b })`]AF
assm:50		ASSM	@@@@ ## ## ##|$$$$ %%%%%%%%%%%;<i>.........................................</i>
-------		operex-field	-------		Here are declared all operation aliases			-------
ZERO		CALCULATE	?r.psw.l|=64:r.psw.l&=-64						ZF
PARITY		CALCULATE	
-------		operex-field	-------
_1			_1	r.pc.n									DB
_2			___2	r.pc.w									ADDR
-------		operex-field	-------
ALU0/ALA0/ALI0	ADD/ADD/ADI	r.psw.h+=$1,r.psw.l=r.psw.fx						Addition
ALU1/ALA1/ALI1	ADC/ADC/ACI	r.psw.h+=$1+(r.psw.l&1),r.psw.l=r.psw.fx				Addition with carry
ALU2/ALA2/ALI2	SUB/SUB/SUI	r.psw.h-=$1,r.psw.l=r.psw.fx						Subtraction
ALU3/ALA3/ALI3	SBB/SBB/SBI	r.psw.h-=$1+(r.psw.l&1),r.psw.l=r.psw.fx				Subtraction with borrow
ALU4/ALA4/ALI4	AND/ANA/ANI	r.psw.h&=$1,r.psw.l=r.psw.fx						Bitwise conjunction
ALU5/ALA5/ALI5	XOR/XRA/XRI	r.psw.h^=$1,r.psw.l=r.psw.fx						Bitwise exclude disjunction
ALU6/ALA6/ALI6	OR/ORA/ORI	r.psw.h|=$1,r.psw.l=r.psw.fx						Bitwise disjunction
ALU7/ALA7/ALI7	CMP/CMP/CPI	r.psw.l=r.psw.h-$1,r.psw.l=r.psw.fx					Comparation
ALR0		ROL		r.psw.h=($1=r.psw.h)*2+(r.psw.l&1),r.psw.l=(r.psw.l&-2)+(($1>>7)&1)	Roll Accumulator Left
ALR1		ROR		$1=r.psw.l&1,r.psw.l=(r.psw.l&-2)+(r.psw.h&1),r.psw.h=(r.psw.h+$1*256)>>1	Roll Accumulator Right
ALR2		RCL		r.psw.h=r.psw.h*2+(r.psw.l&1),r.psw.l=(r.psw.l&126)+(r.psw.fx&1)	Roll Accumulator with Carry
ALR3		RCR		r.psw.l=(r.psw.l&-2)|(r.psw.h&1),r.psw.h=(r.psw.h*257>>1)		Roll Accumulator with Carry
ALR4		DAA		0									Decimal correction After Addition
ALR5		CMA		r.psw.l ^= 0xFF00							Complement Accumulator
ALR6		STC		r.psw.l |= 0x0001							Set Carry
ALR7		CMC		r.psw.l ^= 0x0001							Complement Carry
CON0		NZ		!(r.psw.l & 64)								Not Zero
CON1		Z		!!(r.psw.l & 64)							Zero
CON2		NC		!(r.psw.l & 1)								Not Carry
CON3		C		!!(r.psw.l & 1)								Carry
CON4		PO		!(r.psw.l & 4)								Odd Parity
CON5		PE		!!(r.psw.l & 4)								Even Parity
CON6		NS		!(r.psw.l & 128)							Plus
CON7		S		!!(r.psw.l & 128)							Minus
S0/P0			CX/CX	r.bc.x									B and C
S1/P1			DX/DX	r.de.x									D and E
S2/P2			BX/BX	r.hl.x									H and L
P3			AF	r.psw.x									Status
S3			SP	r.sp.x									Stack
M0			[CX]	r.bc.m									Memory BC
M1			[DX]	r.de.m									Memory BC
R0			CH	r.bc.h									B
R1			CL	r.bc.l									C
R2			DH	r.de.h									D
R3			DL	r.de.l									E
R4			BH	r.hl.h									H
R5			BL	r.hl.l									L
R6			[BX]	r.hl.m									Memory
R7			AL	r.psw.h									Accumulator
-------		pinex-field	-------		Here are declared decoder pins aliases			-------
??_WW?_???_?
ZZ_YYY_XXX_?
-------	-------
-7_3_102_654_?
-?_???_?_WW?_?
-Z_X??_Z_Y??_?
-?_?X?_?_?Y?_?
-?_??X_?_??Y_?
-------		modelex-field	-------		Here are declared instructions set table		-------
XX_XXX_XXX_?	XPU	v1.0	:_1									___SERVICE___DECLARATION___ XPU v1.0
00_000_000_C	NOP		:0									No operation
00_XXX_000_X	NOP	$Y	:0									No operation - $Y
00_XX0_001_E	MOV	S$W,_2	:S$W=_2									Load address into P$Y
00_0X0_010_F	MOV	M$W,AL	:P$M=R7									Store Accumulator to P$W
00_0X1_010_F	MOV	AL,M$W	:R7=M$W									Load Accumulator from P$W
00_100_010_E	MOV	[_2],BX	:$1=_2,m[$1]=R5,m[$1+1]=R4						Store BX
00_101_010_E	MOV	BX,[_2]	:$1=_2,R5=m[$1],R4=m[$1+1]						Load BX
00_110_010_F	MOV	[_2],AL	:m[_2]=R7								Store Accumulator
00_111_010_F	MOV	AL,[_2]	:R7=m[_2]								Load Accumulator
00_XX1_001_D	ADD	BX,S$W	:r.psw.l=(r.psw.l&0xBF)+((P2+S$W)>>16),P2+=S$W				Addition BX with S$W
00_XX0_011_D	INC	S$W	:S$W++									Increment S$W
00_XX1_011_D	DEC	S$W	:S$W--									Decrement S$W
00_XXX_100_A	INC	R$Y	:$1=r.psw.l&1,r.psw.l=R$Y,r.psw.l++,r.psw.l=(r.psw.fx&254)|$1,R$Y++	Increment R$Y
00_XXX_101_A	DEC	R$Y	:$1=r.psw.l&1,r.psw.l=R$Y,r.psw.l--,r.psw.l=(r.psw.fx&254)|$1,R$Y--	Decrement R$Y
00_XXX_110_F	MOV	R$Y,_1	:R$Y=_1									Flip-flop translation byte to R$Y
00_0XX_111_F	ALR$Y	AL,1	:ALR$Y									ALR$Y
00_101_111_F	NOT	AL	:ALR$Y									Invert the Accumulator
00_XXX_111_A	ALR$Y		:ALR$Y									ALR$Y
01_110_110_C	HLT		:r.pc.x --								Halting
01_XXX_XXX_F	MOV	R$Y,R$X	:R$Y=R$X								Flip-flop translation R$X to R$Y
10_XXX_XXX_A	ALU$Y	R$X	:$1=R$X,ALU$Y								ALU$Y
11_XXX_000_B	RCON$Y		:CON$Y?r.pc.x=r.sp.w:0							Return if CON$Y
11_XX0_001_E	POP	P$W	:P$W=r.sp.w								Pop P$Y from stack
11_XXX_010_B	JCON$Y	_2	:$1=_2,CON$Y?r.pc.x=$1:0						Jump if CON$Y
11_000_011_B	JMP	_2	:r.pc.x=_2								Jump to address
11_001_001_B	RET		:r.pc.x=r.sp.w								Return from substitute
11_001_101_B	CALL	_2	:$1=_2,r.sp.w=r.pc.x,r.pc.x=$1						Call substitute
11_010_011_C	OUT	_1,AL	:$1=_1									Output to port
11_011_011_C	IN	AL,_1	:$1=_1									Input from port
11_100_011_E	XCHG	BX,[SP]	:$1=P2,P2=r.sp.w,r.sp.w=$1						Exchange HL with stack heap
11_101_011_E	XCHG	BX,DX	:$1=r.de.x,r.de.x=r.hl.x,r.hl.x=$1					Exchange DE and HL
11_110_011_C	CLI		:0									Disable Interruptions
11_111_011_C	STI		:0									Enable Interruptions
11_101_001_B	JMP	BX	:r.pc.x=r.hl.x								Jump to HL-address
11_111_001_E	MOV	SP,BX	:r.sp.x=r.hl.x								Load HL to SP
11_XXX_100_B	CCON$Y	_2	:$1=_2,CON$Y?(r.sp.w=r.pc.x,r.pc.x=$1):0				Call subroutine in CON$Y
11_XX0_101_E	PUSH	P$W	:r.sp.w=P$W								Push P$Y to stack
11_XXX_110_A	ALU$Y	AL,_1	:$1=_1,ALU$Y								ALU$Y
11_XXX_111_B	INT	$Y	:r.sp.w=r.pc.x,r.pc.x=$Y*8						Restart $Y
11_XX1_101_B	CALL$W	_2	:$1=_2,r.sp.w=r.pc.x,r.pc.x=$1						Call substitute - $Y
0X_XXX_XXX_X	???	$Y	:0									unused
1X_XXX_XXX_X	???	$W$X	:0									unused</textarea>
</p>
<!--
ALU0/ALA0/ALI0	ADD/ADD/ADI	r.psw.h+=$1,r.psw.l=r.psw.fx						Addition
ALU1/ALA4/ALI4	ADC/ADC/ACI	r.psw.h+=$1+(r.psw.l&1),r.psw.l=r.psw.fx				Addition with carry
ALU2/ALA2/ALI2	SUB/SUB/SUI	r.psw.h+=$1,r.psw.l=r.psw.fx						Subtraction
ALU3/ALA6/ALI6	SBB/SBB/SBI	r.psw.h+=$1+(r.psw.l&1),r.psw.l=r.psw.fx				Subtraction with borrow
ALU4/ALA1/ALI1	AND/ANA/ANI	r.psw.h&=$1,r.psw.l=r.psw.fx						Bitwise conjunction
ALU5/ALA5/ALI5	XOR/XRA/XRI	r.psw.h^=$1,r.psw.l=r.psw.fx						Bitwise exclude disjunction
ALU6/ALA3/ALI3	OR/ORA/ORI	r.psw.h|=$1,r.psw.l=r.psw.fx						Bitwise disjunction
ALU7/ALA7/ALI7	CMP/CMP/CPI	$2=r.psw.h,r.psw.h-=$1,r.psw.l=r.psw.fx,r.psw.h=$2			Comparation
ALR0		RLC		r.psw.h=r.psw.h*2+(r.psw.l&1),r.psw.l=(r.psw.l&126)+(r.psw.fx&1)	Roll Accumulator with Carry
ALR1		RRC	r.psw.h						Roll Accumulator with Carry
ALR2		RAL		0									Roll Accumulator Left
ALR3		RAR		0									Roll Accumulator Right
ALR4		DAA		0									Decimal correction After Addition
ALR5		CMA		r.psw.l ^= 0xFF00							Complement Accumulator
ALR6		STC		r.psw.l |= 0x0001							Set Carry
ALR7		CMC		r.psw.l ^= 0x0001							Complement Carry
CON0		NZ		!(r.psw.l & 64)								Not Zero
CON1		Z		!!(r.psw.l & 64)							Zero
CON2		NC		!(r.psw.l & 1)								Not Carry
CON3		C		!!(r.psw.l & 1)								Carry
CON4		PO		!(r.psw.l & 4)								Odd Parity
CON5		PE		!!(r.psw.l & 4)								Even Parity
CON6		P		!(r.psw.l & 128)							Plus
CON7		M		!!(r.psw.l & 128)							Minus
S0/P0			CX/CX	r.bc.x									B and C
S1/P1			DX/DX	r.de.x									D and E
S2/P2			BX/BX	r.hl.x									H and L
P3			PSW	r.psw.x									Status
S3			SP	r.sp.x									Stack
R0			CH	r.bc.h									B
R4			CL	r.bc.l									C
R2			DH	r.de.h									D
R6			DL	r.de.l									E
R1			BH	r.hl.h									H
R5			BL	r.hl.l									L
R3			[BX]	r.hl.m									Memory
R7			AL	r.psw.h									Accumulator

XX_XXX_XXX_?	XPU	v1.0	:_1									___SERVICE___DECLARATION___ XPU v1.0
00_000_000_C	NOP		:0									No operation
00_XX0_001_E	MOV	S$W,_2	:S$W=_2									Load address into P$Y
00_0X0_010_F	MOV	[P$W],R7:P$W.m=R7								Store Accumulator to P$W
00_0X1_010_F	MOV	R7,[P$W]:R7=P$W.m								Load Accumulator from P$W
00_100_010_E	MOV	[_2],P2	:$1=_2,m[$1]=R5,m[$1+1]=R4						Store HL
00_101_010_E	MOV	P2,[_2]	:$1=_2,R5=m[$1],R4=m[$1+1]						Load HL
00_110_010_F	MOV	[_2],R7	:m[_2]=R7								Store Accumulator
00_111_010_F	MOV	R7,[_2]	:R7=m[_2]								Load Accumulator
00_XX1_001_D	ADD	P2,S$W	:r.psw.l=(r.psw.l&0xBF)+((P2+S$W)>>16),P2+=S$W				Addition HL with S$W
00_XX0_011_D	INC	S$W	:S$W++									Increment S$W
00_XX1_011_D	DEC	S$W	:S$W--									Decrement S$W
00_XXX_100_A	INC	R$Y	:$1=r.psw.l&1,r.psw.l=R$Y,r.psw.l++,r.psw.l=(r.psw.fx&254)|$1,R$Y++	Increment R$Y
00_XXX_101_A	DEC	R$Y	:$1=r.psw.l&1,r.psw.l=R$Y,r.psw.l--,r.psw.l=(r.psw.fx&254)|$1,R$Y--	Decrement R$Y
00_XXX_110_F	MOV	R$Y,_1	:R$Y=_1									Flip-flop translation byte to R$Y
00_XXX_111_A	ALR$Y		:ALR$Y									ALR$Y
01_110_110_C	HLT		:r.pc.x --								Halting
01_XXX_XXX_F	MOV	R$Y,R$X	:R$Y=R$X								Flip-flop translation R$X to R$Y
10_XXX_XXX_A	ALU$Y	R7,R$X	:$1=R$X,ALU$Y								ALA$Y
11_XXX_000_B	RCON$Y		:CON$Y?r.pc.x=r.sp.w:0							Return if CON$Y
11_XX0_001_E	POP	P$W	:P$W=r.sp.w								Pop P$Y from stack
11_XXX_010_B	JCON$Y	_2	:$1=_2,CON$Y?r.pc.x=$1:0						Jump if CON$Y
11_000_011_B	JMP	_2	:r.pc.x=_2								Jump to address
11_001_001_B	RET		:r.pc.x=r.sp.w								Return from substitute
11_001_101_B	CALL	_2	:$1=_2,r.sp.w=r.pc.x,r.pc.x=$1						Call substitute
11_010_011_C	OUT	_1	:$1=_1									Output to port
11_011_011_C	IN	_1	:$1=_1									Input from port
11_100_011_E	XCHG	S2,[S3]	:$1=P2,P2=r.sp.w,r.sp.w=$1						Exchange HL with stack heap
11_101_011_E	XCHG	S2,S1	:$1=S2,S2=S1,S1=$1							Exchange DE and HL
11_110_011_C	DI		:0									Disable Interruptions
11_111_011_C	EI		:0									Enable Interruptions
11_101_001_b	JMP	P2	:r.pc.x=S2								Jump to HL-address
11_111_001_E	MOV	S3,P2	:S3=S2									Load HL to SP
11_XXX_100_B	CCON$Y	_2	:$1=_2,CON$Y?(r.sp.w=r.pc.x,r.pc.x=$1):0				Call subroutine in CON$Y
11_XX0_101_E	PUSH	P$W	:r.sp.w=P$W								Push P$Y to stack
11_XXX_110_A	ALU$Y	R7,_1	:$1=_1,ALI$Y								ALI$Y
11_XXX_111_B	RST	$Y	:r.sp.w=r.pc.x,r.pc.x=$Y*8						Restart $Y
0X_XXX_XXX_X	???	$Y	:0									unused
--><pre id=Commands></pre></td>
<td rowspan=2><pre id=ByteCode contenteditable=true></pre>
<nobr><input id=Address size=13 style=color:cyan value='' type=text accessKey=P title='Pointer/Poking data [ALT+P]' onblur='cpu.watch.active=""' onfocus='cpu.watch.active="P"'
/><input id=Mnemonic size=27 style=color:lightgreen value='' type=text accessKey=T title='Translation/Translator [ALT+T]' onblur='cpu.watch.active=""' onfocus='cpu.watch.active="T"'
/><input id=Remark size=37 style=color:yellow value='' type=text accessKey=R title='Remark/Remote [ALT+R]' onblur='cpu.watch.active=""' onfocus='cpu.watch.active="R"' /></nobr>
</td>
</tr>
<tr valign=top><td><pre id=Screen></pre></td></tr>
</table>
<pre id=Logging></pre><pre id=state></pre>
</body>
